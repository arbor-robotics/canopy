const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./leaflet-src.gPfWyBzh.js","./_commonjsHelpers.BosuxZz1.js"])))=>i.map(i=>d[i]);
import{_ as L}from"./preload-helper.C1FmrZbK.js";import{s as q,e as B,c as Z,b as H,f as I,l as T,i as K,n as k,o as Q}from"./scheduler.DAJm3Tm7.js";import{S as U,i as X}from"./index.CY_bOgko.js";import{s as ee,e as te,a as ne,b as O,p as D,w as oe}from"./stores.CpqAsVgL.js";import{g as ae}from"./forest_generator.BejyUwkV.js";/* empty css                                             */function re(p){let a;return{c(){a=B("div"),this.h()},l(i){a=Z(i,"DIV",{id:!0,class:!0}),H(a).forEach(I),this.h()},h(){T(a,"id","map"),T(a,"class","z-0 svelte-14m2v8w")},m(i,r){K(i,a,r)},p:k,i:k,o:k,d(i){i&&I(a)}}}function se(p,a,i){let r,o,w,h,g,l,c,n,v,x,b,{seedlings:m=[]}=a,y=!1,u=[],d=[],f=1;function A(){y=!0}function $(){d.forEach(e=>{e.remove(),console.log(`Removing ${e} from map.`)}),d=[]}async function _(e){var t=n.marker([e.lat,e.lon],{icon:x}).addTo(o);d.push(t)}function P(){n.marker([l,c],{icon:b}).addTo(o),d.forEach(e=>{let t=o.distance(e.getLatLng(),[l,c]);console.log(t),t<2&&e.remove()})}ee.subscribe(e=>{console.log("Seedling reached!"),e!=!1&&P()}),te.subscribe(e=>{if(l=e,!(n==null||!c))if(!g)g=n.marker([l,c],{icon:h}).addTo(o);else{var t=new n.LatLng(l,c);g.setLatLng(t)}}),ne.subscribe(e=>{if(console.log("Longitude updated!"),c=e,!(n==null||!l))if(!g)g=n.marker([l,c],{icon:h}).addTo(o);else{var t=new n.LatLng(l,c);g.setLatLng(t)}}),O.subscribe(e=>{if(n==null||!O)return;let t=document.getElementById("ego-icon");if(!t)return;let s=-e+Math.PI/2;t.style.transform=`rotate(${s}rad)`}),D.subscribe(e=>{e!=null&&(console.log(`Seedling markers contains ${d.length} seedlings`),d.forEach(t=>{t.remove(),console.log(`Removing ${t} from map.`)}),d=[],console.log(`Seedling markers now contains ${d.length} seedlings`),e.seedlings.forEach((t,s)=>{t==null&&console.log(`Seedling at ${s} was ${t}`),_(t)}),r&&r.setData(e.bounds))});function N(e){if(y){var t=n.marker(e.latlng,{icon:w}).addTo(o),s=u.pop();s!=null&&s.removeFrom(o),u.push(t),y=!1,console.log(`There are now ${u.length} waypoints on the map.`);let S=[];u.forEach(Y=>{let M=Y.getLatLng();S.push([M.lat,M.lng])}),console.log(S),oe.set(S)}}function R(e){f==0&&(console.log("Making forest"),ae(E(),$,_,10).then(t=>{i(0,m=t)}))}function C(){try{let e=localStorage.getItem("plan");e!=null&&D.set(JSON.parse(e))}catch(e){console.error(`Could not load plan from browser storage: ${e}`)}}Q(async()=>{n=await L(()=>import("./leaflet-src.gPfWyBzh.js").then(e=>e.l),__vite__mapDeps([0,1]),import.meta.url),await L(()=>import("./leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await L(()=>import("./Leaflet.PaintPolygon.BL41ABOh.js"),[],import.meta.url),o=n.map("map").setView([40.44002092,-79.9409749],19),v=n.popup(),w=n.divIcon({html:`<span class="material-symbols-outlined">
flag
</span>`,className:"div-icon"}),h=n.divIcon({html:`<div class="icon-container flex justify-center" id="ego-icon">
  <span
    class="material-symbols-rounded my-auto"
    style="--icon-color: #ff0000; --size: 1rem; --fill: 1"
  >
    navigation
  </span>
</div>`,className:"div-icon"}),x=n.divIcon({html:`<div class="icon-container flex justify-center" id="seedling-icon" style="">
  <span
    class="material-symbols-rounded my-auto"
    style="--icon-color: #ff0000; --size: 1rem; --fill: 1"
  >
    psychiatry
  </span>
</div>`,className:"div-icon",iconAnchor:[0,10]}),b=n.divIcon({html:`<div class="icon-container flex justify-center" id="seedling-icon" style="">
  <span
    class="material-symbols-rounded my-auto"
    style="--icon-color: #ff0000; --size: 1rem; --fill: 1"
  >
    check
  </span>
</div>`,className:"div-icon",iconAnchor:[0,20]}),n.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:20,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(o),r=n.control.paintPolygon({menu:!1}).addTo(o),o.on("click",N),o.on("mouseup",R),C()});function E(){return r.getData()}function z(){return m}function F(){f=0,r.startDraw()}function V(){f=3,r.startErase()}function J(){f=1,r.stop()}function j(){r.eraseAll(),$()}function G(e){let t=n.latLng(e[0],e[1]);v.setLatLng(t).setContent("You clicked the map at "+t.toString()).openOn(o),n.marker(t).addTo(o),console.log(`Adding point at ${e[0]}, ${e[1]}`)}function W(e){e.forEach(t=>{let s=n.latLng(t[0],t[1]);v.setLatLng(s).setContent("You clicked the map at "+s.toString()).openOn(o),n.marker(s).addTo(o),console.log(`Adding point at ${t[0]}, ${t[1]}`)})}return p.$$set=e=>{"seedlings"in e&&i(0,m=e.seedlings)},[m,A,$,_,P,E,z,F,V,J,j,G,W]}class ue extends U{constructor(a){super(),X(this,a,se,re,q,{seedlings:0,listenForWaypoint:1,clearSeedlingMarkers:2,addSeedlingMarker:3,addReachedSeedlingMarker:4,getGeoJSON:5,getPlanSeedlings:6,startDraw:7,startErase:8,startPan:9,clear:10,addPoint:11,addPoints:12},null,[-1,-1])}get listenForWaypoint(){return this.$$.ctx[1]}get clearSeedlingMarkers(){return this.$$.ctx[2]}get addSeedlingMarker(){return this.$$.ctx[3]}get addReachedSeedlingMarker(){return this.$$.ctx[4]}get getGeoJSON(){return this.$$.ctx[5]}get getPlanSeedlings(){return this.$$.ctx[6]}get startDraw(){return this.$$.ctx[7]}get startErase(){return this.$$.ctx[8]}get startPan(){return this.$$.ctx[9]}get clear(){return this.$$.ctx[10]}get addPoint(){return this.$$.ctx[11]}get addPoints(){return this.$$.ctx[12]}}export{ue as O};
