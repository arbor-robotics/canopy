const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./leaflet-src.gPfWyBzh.js","./_commonjsHelpers.BosuxZz1.js"])))=>i.map(i=>d[i]);
import{_ as L}from"./preload-helper.C1FmrZbK.js";import{s as j,e as Y,c as q,b as B,f as b,l as M,i as Z,n as S,o as H}from"./scheduler.38Bkksq3.js";import{S as K,i as Q}from"./index.W5a3pFe-.js";import{e as U,a as X,b as I,p as O,w as ee}from"./stores.CZBKnDD7.js";import{g as te}from"./OsmMap.svelte_svelte_type_style_lang.7d7b6diA.js";function oe(f){let a;return{c(){a=Y("div"),this.h()},l(i){a=q(i,"DIV",{id:!0,class:!0}),B(a).forEach(b),this.h()},h(){M(a,"id","map"),M(a,"class","z-0 svelte-14m2v8w")},m(i,r){Z(i,a,r)},p:S,i:S,o:S,d(i){i&&b(a)}}}function ne(f,a,i){let r,n,k,h,c,d,g,o,v,P,{seedlings:m=[]}=a,$=!1,u=[],l=[],p=1;function T(){$=!0}function y(){l.forEach(e=>{e.remove(),console.log(`Removing ${e} from map.`)}),l=[]}async function _(e){var t=o.marker([e.lat,e.lon],{icon:P}).addTo(n);l.push(t)}U.subscribe(e=>{if(d=e,!(o==null||!g))if(!c)c=o.marker([d,g],{icon:h}).addTo(n);else{var t=new o.LatLng(d,g);c.setLatLng(t)}}),X.subscribe(e=>{if(console.log("Longitude updated!"),g=e,!(o==null||!d))if(!c)c=o.marker([d,g],{icon:h}).addTo(n);else{var t=new o.LatLng(d,g);c.setLatLng(t)}}),I.subscribe(e=>{if(o==null||!I)return;let t=document.getElementById("ego-icon");if(!t)return;let s=-e+Math.PI/2;t.style.transform=`rotate(${s}rad)`}),O.subscribe(e=>{e!=null&&(console.log(`Seedling markers contains ${l.length} seedlings`),l.forEach(t=>{t.remove(),console.log(`Removing ${t} from map.`)}),l=[],console.log(`Seedling markers now contains ${l.length} seedlings`),e.seedlings.forEach((t,s)=>{t==null&&console.log(`Seedling at ${s} was ${t}`),_(t)}),r&&r.setData(e.bounds))});function D(e){if($){var t=o.marker(e.latlng,{icon:k}).addTo(n),s=u.pop();s!=null&&s.removeFrom(n),u.push(t),$=!1,console.log(`There are now ${u.length} waypoints on the map.`);let w=[];u.forEach(W=>{let E=W.getLatLng();w.push([E.lat,E.lng])}),console.log(w),ee.set(w)}}function A(e){p==0&&(console.log("Making forest"),te(x(),y,_,10).then(t=>{i(0,m=t)}))}function N(){try{let e=localStorage.getItem("plan");e!=null&&O.set(JSON.parse(e))}catch(e){console.error(`Could not load plan from browser storage: ${e}`)}}H(async()=>{o=await L(()=>import("./leaflet-src.gPfWyBzh.js").then(e=>e.l),__vite__mapDeps([0,1]),import.meta.url),await L(()=>import("./leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await L(()=>import("./Leaflet.PaintPolygon.BL41ABOh.js"),[],import.meta.url),n=o.map("map").setView([40.44002092,-79.9409749],19),v=o.popup(),k=o.divIcon({html:`<span class="material-symbols-outlined">
flag
</span>`,className:"div-icon"}),h=o.divIcon({html:`<div class="icon-container flex justify-center" id="ego-icon">
  <span
    class="material-symbols-rounded my-auto"
    style="--icon-color: #ff0000; --size: 1rem; --fill: 1"
  >
    navigation
  </span>
</div>`,className:"div-icon"}),P=o.divIcon({html:`<div class="icon-container flex justify-center" id="seedling-icon" style="">
  <span
    class="material-symbols-rounded my-auto"
    style="--icon-color: #ff0000; --size: 1rem; --fill: 1"
  >
    psychiatry
  </span>
</div>`,className:"div-icon",iconAnchor:[0,20]}),o.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:20,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(n),r=o.control.paintPolygon({menu:!1}).addTo(n),n.on("click",D),n.on("mouseup",A),N()});function x(){return r.getData()}function C(){return m}function F(){p=0,r.startDraw()}function R(){p=3,r.startErase()}function V(){p=1,r.stop()}function z(){r.eraseAll(),y()}function J(e){let t=o.latLng(e[0],e[1]);v.setLatLng(t).setContent("You clicked the map at "+t.toString()).openOn(n),o.marker(t).addTo(n),console.log(`Adding point at ${e[0]}, ${e[1]}`)}function G(e){e.forEach(t=>{let s=o.latLng(t[0],t[1]);v.setLatLng(s).setContent("You clicked the map at "+s.toString()).openOn(n),o.marker(s).addTo(n),console.log(`Adding point at ${t[0]}, ${t[1]}`)})}return f.$$set=e=>{"seedlings"in e&&i(0,m=e.seedlings)},[m,T,y,_,x,C,F,R,V,z,J,G]}class ce extends K{constructor(a){super(),Q(this,a,ne,oe,j,{seedlings:0,listenForWaypoint:1,clearSeedlingMarkers:2,addSeedlingMarker:3,getGeoJSON:4,getPlanSeedlings:5,startDraw:6,startErase:7,startPan:8,clear:9,addPoint:10,addPoints:11})}get listenForWaypoint(){return this.$$.ctx[1]}get clearSeedlingMarkers(){return this.$$.ctx[2]}get addSeedlingMarker(){return this.$$.ctx[3]}get getGeoJSON(){return this.$$.ctx[4]}get getPlanSeedlings(){return this.$$.ctx[5]}get startDraw(){return this.$$.ctx[6]}get startErase(){return this.$$.ctx[7]}get startPan(){return this.$$.ctx[8]}get clear(){return this.$$.ctx[9]}get addPoint(){return this.$$.ctx[10]}get addPoints(){return this.$$.ctx[11]}}export{ce as O};
