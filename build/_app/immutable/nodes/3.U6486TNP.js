import{d as ln}from"../chunks/index.R8ovVqwX.js";import{a5 as Re,a6 as we,s as _e,E as ue,i as H,f as M,F as be,k as de,G as ie,H as Ve,w as Ne,J as xe,e as z,c as R,b as B,a7 as Ee,O as Ye,L as ye,M as De,N as ke,n as se,A as cn,r as un,v as Ie,l as T,o as Ke,aa as Oe,ad as Ht,a as $,g as ee,u as fn,z as oe,h as A,ae as Lt,t as dn,d as mn,U as hn,x as mt,y as ht}from"../chunks/scheduler.BVUDL6Zt.js";import{S as Ce,i as Me,g as me,t as P,d as he,a as k,c as Y,b as K,m as X,e as J,k as Gt,j as pn,h as vn}from"../chunks/index.DgboukHs.js";import{e as He}from"../chunks/each.C21na-_s.js";import"../chunks/entry.D6TZnA4L.js";import{I as Pe}from"../chunks/Icon.D-E2Vsf5.js";import{d as Wt,w as ve}from"../chunks/index.BkEj4Br1.js";import{M as re,C as Se,F as pt,I as gn,u as bn,v as _n,x as xn}from"../chunks/stores.DzPvbtKP.js";import{o as yn,w as Le,m as vt,t as gt,h as bt,c as Dn,d as et,f as tt,b as kn,e as Cn,j as Ge,a as Mn,i as nt,k as ce,v as rt}from"../chunks/create.COEjqSst.js";import{B as qe}from"../chunks/button.C6OI13Oa.js";import{g as Xe}from"../chunks/spread.CgU5AtxT.js";import{o as Pn,c as wn}from"../chunks/events.N_ljOtRp.js";import{t as En,a as In,c as On,r as Sn,g as Tn}from"../chunks/updater.BFZp51Sx.js";import{s as ot}from"../chunks/math.BpeAD72X.js";import{P as Nn,t as An,V as ct,M as zn,a as Zt,S as ge,b as Ut,W as Rn}from"../chunks/World.D7J9wgPp.js";import{F as Vn}from"../chunks/forest_generator.DRvdXYq1.js";import{O as jn}from"../chunks/OsmMap.Gc4sw2sJ.js";import{f as _t}from"../chunks/index.BnjJtbdy.js";const Fn={defaultValue:[],min:0,max:100,step:1,orientation:"horizontal",dir:"ltr",disabled:!1},{name:We}=Dn("slider"),Bn=n=>{const e={...Fn,...n},r=En(yn(e,"value","onValueChange","defaultValue")),{min:t,max:o,step:i,orientation:a,dir:c,disabled:s}=r,l=e.value??ve(e.defaultValue),u=Pn(l,e==null?void 0:e.onValueChange),f=Le(ve(!1)),m=Le(ve(0)),d=Le(ve(null)),p=In(["root"]),h=(v,C)=>{u.update(I=>{if(!I)return[v];if(I[C]===v)return I;const N=[...I],g=N[C]>v?-1:1;function b(){N[C]=N[C+g],N[C+g]=v;const G=x();G&&(G[C+g].focus(),d.set({thumb:G[C+g],index:C+g}))}if(g===-1&&v<N[C-1])return b(),N;if(g===1&&v>N[C+1])return b(),N;const y=t.get(),j=o.get(),Q=i.get();return N[C]=ot(v,y,j,Q),N})},x=()=>{const v=rt(p.root);return v?Array.from(v.querySelectorAll('[data-melt-part="thumb"]')).filter(C=>nt(C)):null},O=Wt([t,o],([v,C])=>I=>(I-v)/(C-v)*100),F=Le.derived([a,c],([v,C])=>v==="horizontal"?C==="rtl"?"rl":"lr":C==="rtl"?"tb":"bt"),D=vt(We(),{stores:[s,a,c],returned:([v,C,I])=>({dir:I,disabled:et(v),"data-disabled":et(v),"data-orientation":C,style:v?void 0:`touch-action: ${C==="horizontal"?"pan-y":"pan-x"}`,"data-melt-id":p.root})}),w=vt(We("range"),{stores:[u,F,O],returned:([v,C,I])=>{const N=v.length>1?I(Math.min(...v)??0):0,g=100-I(Math.max(...v)??0),b={position:"absolute"};switch(C){case"lr":{b.left=`${N}%`,b.right=`${g}%`;break}case"rl":{b.right=`${N}%`,b.left=`${g}%`;break}case"bt":{b.bottom=`${N}%`,b.top=`${g}%`;break}case"tb":{b.top=`${N}%`,b.bottom=`${g}%`;break}}return{style:tt(b)}}}),L=gt(We("thumb"),{stores:[u,O,t,o,s,a,F],returned:([v,C,I,N,g,b,y])=>Array.from({length:v.length||1},(Q,G)=>{m.get()<v.length&&m.update(_=>_+1);const W=v[G],V=`${C(W)}%`,E={position:"absolute"};switch(y){case"lr":{E.left=V,E.translate="-50% 0";break}case"rl":{E.right=V,E.translate="50% 0";break}case"bt":{E.bottom=V,E.translate="0 50%";break}case"tb":{E.top=V,E.translate="0 -50%";break}}return{role:"slider","aria-valuemin":I,"aria-valuemax":N,"aria-valuenow":W,"aria-disabled":et(g),"aria-orientation":b,"data-melt-part":"thumb","data-value":W,style:tt(E),tabindex:g?-1:0}}),action:v=>({destroy:Mn(v,"keydown",I=>{if(s.get())return;const N=I.currentTarget;if(!nt(N))return;const g=x();if(!(g!=null&&g.length))return;const b=g.indexOf(N);if(m.set(b),![ce.ARROW_LEFT,ce.ARROW_RIGHT,ce.ARROW_UP,ce.ARROW_DOWN,ce.HOME,ce.END].includes(I.key))return;I.preventDefault();const y=t.get(),j=o.get(),Q=i.get(),G=u.get(),pe=a.get(),W=F.get(),V=G[b];switch(I.key){case ce.HOME:{h(y,b);break}case ce.END:{h(j,b);break}case ce.ARROW_LEFT:{if(pe!=="horizontal")break;I.metaKey?h(W==="rl"?j:y,b):W==="rl"&&V<j?h(V+Q,b):W==="lr"&&V>y&&h(V-Q,b);break}case ce.ARROW_RIGHT:{if(pe!=="horizontal")break;I.metaKey?h(W==="rl"?y:j,b):W==="rl"&&V>y?h(V-Q,b):W==="lr"&&V<j&&h(V+Q,b);break}case ce.ARROW_UP:{I.metaKey?h(W==="tb"?y:j,b):W==="tb"&&V>y?h(V-Q,b):W!=="tb"&&V<j&&h(V+Q,b);break}case ce.ARROW_DOWN:{I.metaKey?h(W==="tb"?j:y,b):W==="tb"&&V<j?h(V+Q,b):W!=="tb"&&V>y&&h(V-Q,b);break}}})})}),Z=gt(We("tick"),{stores:[u,t,o,i,F],returned:([v,C,I,N,g])=>{const b=I-C;let y=Math.ceil(b/N);return b%N==0&&y++,Array.from({length:y},(j,Q)=>{const G=`${Q*(N/(I-C))*100}%`,pe=Q===0,W=Q===y-1,V=pe?0:W?-100:-50,E={position:"absolute"};switch(g){case"lr":{E.left=G,E.translate=`${V}% 0`;break}case"rl":{E.right=G,E.translate=`${-V}% 0`;break}case"bt":{E.bottom=G,E.translate=`0 ${-V}%`;break}case"tb":{E.top=G,E.translate=`0 ${V}%`;break}}const _=C+Q*N;return{"data-bounded":(v.length===1?_<=v[0]:v[0]<=_&&_<=v[v.length-1])?!0:void 0,"data-value":_,style:tt(E)}})}});return bt([D,t,o,s,a,F,i],([v,C,I,N,g,b,y])=>{if(!kn||N)return;const j=(E,_,S,U)=>{const te=(E-S)/(U-S)*(I-C)+C;if(te<C)h(C,_);else if(te>I)h(I,_);else{const ne=y,le=C,fe=Math.floor((te-le)/ne),Ae=le+fe*ne+ne/2,an=le+(fe+1)*ne+ne/2,dt=te>=Ae&&te<an?(fe+1)*ne+le:fe*ne+le;dt<=I&&h(dt,_)}},Q=E=>{const _=x();if(!_)return;_.forEach(te=>te.blur());const S=_.map(te=>{if(g==="horizontal"){const{left:ne,right:le}=te.getBoundingClientRect();return Math.abs(E.clientX-(ne+le)/2)}else{const{top:ne,bottom:le}=te.getBoundingClientRect();return Math.abs(E.clientY-(ne+le)/2)}}),U=_[S.indexOf(Math.min(...S))],ae=_.indexOf(U);return{thumb:U,index:ae}},G=E=>{if(!f.get())return;E.preventDefault(),E.stopPropagation();const _=rt(v["data-melt-id"]),S=d.get();if(!_||!S)return;S.thumb.focus();const{left:U,right:ae,top:te,bottom:ne}=_.getBoundingClientRect();switch(b){case"lr":{j(E.clientX,S.index,U,ae);break}case"rl":{j(E.clientX,S.index,ae,U);break}case"bt":{j(E.clientY,S.index,ne,te);break}case"tb":{j(E.clientY,S.index,te,ne);break}}},pe=E=>{if(E.button!==0)return;const _=rt(v["data-melt-id"]),S=Q(E);if(!S||!_)return;const U=E.target;!nt(U)||!_.contains(U)||(E.preventDefault(),d.set(S),S.thumb.focus(),f.set(!0),G(E))},W=()=>{f.set(!1)},V=Cn(Ge(document,"pointerdown",pe),Ge(document,"pointerup",W),Ge(document,"pointerleave",W),Ge(document,"pointermove",G));return()=>{V()}}),bt([i,t,o,u],function([C,I,N,g]){const b=j=>ot(j,I,N,C)===j,y=j=>ot(j,I,N,C);g.some(j=>!b(j))&&u.update(j=>j.map(y))}),{elements:{root:D,thumbs:L,range:w,ticks:Z},states:{value:u},options:r}};function qt(){return{NAME:"slider",PARTS:["root","input","range","thumb","tick"]}}function Hn(n){const{NAME:e,PARTS:r}=qt(),t=On(e,r),o={...Bn(Sn(n)),getAttrs:t};return Re(e,o),{...o,updateOption:Tn(o.options)}}function ut(){const{NAME:n}=qt();return we(n)}const Ln=n=>({builder:n&4,ticks:n&8,thumbs:n&16}),xt=n=>({builder:n[2],ticks:n[3],thumbs:n[4]}),Gn=n=>({builder:n&4,ticks:n&8,thumbs:n&16}),yt=n=>({builder:n[2],ticks:n[3],thumbs:n[4]});function Wn(n){let e,r,t,o;const i=n[19].default,a=xe(i,n,n[18],xt);let c=[n[2],n[8]],s={};for(let l=0;l<c.length;l+=1)s=ie(s,c[l]);return{c(){e=z("span"),a&&a.c(),this.h()},l(l){e=R(l,"SPAN",{});var u=B(e);a&&a.l(u),u.forEach(M),this.h()},h(){Ee(e,s)},m(l,u){H(l,e,u),a&&a.m(e,null),n[20](e),r=!0,t||(o=Ye(n[2].action(e)),t=!0)},p(l,u){a&&a.p&&(!r||u&262172)&&ye(a,i,l,l[18],r?ke(i,l[18],u,Ln):De(l[18]),xt),Ee(e,s=Xe(c,[u&4&&l[2],u&256&&l[8]]))},i(l){r||(k(a,l),r=!0)},o(l){P(a,l),r=!1},d(l){l&&M(e),a&&a.d(l),n[20](null),t=!1,o()}}}function Zn(n){let e;const r=n[19].default,t=xe(r,n,n[18],yt);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&262172)&&ye(t,r,o,o[18],e?ke(r,o[18],i,Gn):De(o[18]),yt)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}function Un(n){let e,r,t,o;const i=[Zn,Wn],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=i[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),H(s,t,l),o=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=i[e](s),r.c()),k(r,1),r.m(t.parentNode,t))},i(s){o||(k(r),o=!0)},o(s){P(r),o=!1},d(s){s&&M(t),a[e].d(s)}}}function qn(n,e,r){let t;const o=["disabled","min","max","step","orientation","dir","value","onValueChange","asChild","el"];let i=be(e,o),a,c,s,{$$slots:l={},$$scope:u}=e,{disabled:f=void 0}=e,{min:m=void 0}=e,{max:d=void 0}=e,{step:p=void 0}=e,{orientation:h=void 0}=e,{dir:x=void 0}=e,{value:O=void 0}=e,{onValueChange:F=void 0}=e,{asChild:D=!1}=e,{el:w=void 0}=e;const{elements:{root:L,ticks:Z,thumbs:v},states:{value:C},updateOption:I,getAttrs:N}=Hn({disabled:f,dir:x,min:m,max:d,step:p,orientation:h,defaultValue:O,onValueChange:({next:y})=>(O!==y&&(F==null||F(y),r(9,O=y)),y)});de(n,L,y=>r(17,a=y)),de(n,Z,y=>r(3,c=y)),de(n,v,y=>r(4,s=y));const g=N("root");function b(y){Ne[y?"unshift":"push"](()=>{w=y,r(0,w)})}return n.$$set=y=>{e=ie(ie({},e),Ve(y)),r(8,i=be(e,o)),"disabled"in y&&r(10,f=y.disabled),"min"in y&&r(11,m=y.min),"max"in y&&r(12,d=y.max),"step"in y&&r(13,p=y.step),"orientation"in y&&r(14,h=y.orientation),"dir"in y&&r(15,x=y.dir),"value"in y&&r(9,O=y.value),"onValueChange"in y&&r(16,F=y.onValueChange),"asChild"in y&&r(1,D=y.asChild),"el"in y&&r(0,w=y.el),"$$scope"in y&&r(18,u=y.$$scope)},n.$$.update=()=>{n.$$.dirty&512&&O!==void 0&&C.set(O),n.$$.dirty&1024&&I("disabled",f),n.$$.dirty&2048&&I("min",m),n.$$.dirty&4096&&I("max",d),n.$$.dirty&8192&&I("step",p),n.$$.dirty&16384&&I("orientation",h),n.$$.dirty&32768&&I("dir",x),n.$$.dirty&131072&&r(2,t=a),n.$$.dirty&4&&Object.assign(t,g)},[w,D,t,c,s,L,Z,v,i,O,f,m,d,p,h,x,F,a,u,l,b]}class Yn extends Ce{constructor(e){super(),Me(this,e,qn,Un,_e,{disabled:10,min:11,max:12,step:13,orientation:14,dir:15,value:9,onValueChange:16,asChild:1,el:0})}}const Kn=n=>({builder:n&4}),Dt=n=>({builder:n[2]});function Xn(n){let e,r,t,o=[n[2],n[4]],i={};for(let a=0;a<o.length;a+=1)i=ie(i,o[a]);return{c(){e=z("span"),this.h()},l(a){e=R(a,"SPAN",{}),B(e).forEach(M),this.h()},h(){Ee(e,i)},m(a,c){H(a,e,c),n[8](e),r||(t=Ye(n[2].action(e)),r=!0)},p(a,c){Ee(e,i=Xe(o,[c&4&&a[2],c&16&&a[4]]))},i:se,o:se,d(a){a&&M(e),n[8](null),r=!1,t()}}}function Jn(n){let e;const r=n[7].default,t=xe(r,n,n[6],Dt);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&68)&&ye(t,r,o,o[6],e?ke(r,o[6],i,Kn):De(o[6]),Dt)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}function Qn(n){let e,r,t,o;const i=[Jn,Xn],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=i[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),H(s,t,l),o=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=i[e](s),r.c()),k(r,1),r.m(t.parentNode,t))},i(s){o||(k(r),o=!0)},o(s){P(r),o=!1},d(s){s&&M(t),a[e].d(s)}}}function $n(n,e,r){let t;const o=["asChild","el"];let i=be(e,o),a,{$$slots:c={},$$scope:s}=e,{asChild:l=!1}=e,{el:u=void 0}=e;const{elements:{range:f},getAttrs:m}=ut();de(n,f,h=>r(5,a=h));const d=m("range");function p(h){Ne[h?"unshift":"push"](()=>{u=h,r(0,u)})}return n.$$set=h=>{e=ie(ie({},e),Ve(h)),r(4,i=be(e,o)),"asChild"in h&&r(1,l=h.asChild),"el"in h&&r(0,u=h.el),"$$scope"in h&&r(6,s=h.$$scope)},n.$$.update=()=>{n.$$.dirty&32&&r(2,t=a),n.$$.dirty&4&&Object.assign(t,d)},[u,l,t,f,i,a,s,c,p]}class er extends Ce{constructor(e){super(),Me(this,e,$n,Qn,_e,{asChild:1,el:0})}}const tr=n=>({builder:n&4}),kt=n=>({builder:n[2]});function nr(n){let e,r,t,o=[n[2],n[4]],i={};for(let a=0;a<o.length;a+=1)i=ie(i,o[a]);return{c(){e=z("span"),this.h()},l(a){e=R(a,"SPAN",{}),B(e).forEach(M),this.h()},h(){Ee(e,i)},m(a,c){H(a,e,c),n[8](e),r||(t=[Ye(n[2].action(e)),cn(e,"m-keydown",n[3])],r=!0)},p(a,c){Ee(e,i=Xe(o,[c&4&&a[2],c&16&&a[4]]))},i:se,o:se,d(a){a&&M(e),n[8](null),r=!1,un(t)}}}function rr(n){let e;const r=n[7].default,t=xe(r,n,n[6],kt);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&68)&&ye(t,r,o,o[6],e?ke(r,o[6],i,tr):De(o[6]),kt)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}function or(n){let e,r,t,o;const i=[rr,nr],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=i[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),H(s,t,l),o=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=i[e](s),r.c()),k(r,1),r.m(t.parentNode,t))},i(s){o||(k(r),o=!0)},o(s){P(r),o=!1},d(s){s&&M(t),a[e].d(s)}}}function ir(n,e,r){let t;const o=["asChild","el","thumb"];let i=be(e,o),{$$slots:a={},$$scope:c}=e,{asChild:s=!1}=e,{el:l=void 0}=e,{thumb:u}=e;const{getAttrs:f}=ut(),m=wn(),d=f("thumb");function p(h){Ne[h?"unshift":"push"](()=>{l=h,r(0,l)})}return n.$$set=h=>{e=ie(ie({},e),Ve(h)),r(4,i=be(e,o)),"asChild"in h&&r(1,s=h.asChild),"el"in h&&r(0,l=h.el),"thumb"in h&&r(5,u=h.thumb),"$$scope"in h&&r(6,c=h.$$scope)},n.$$.update=()=>{n.$$.dirty&32&&r(2,t=u),n.$$.dirty&4&&Object.assign(t,d)},[l,s,t,m,i,u,c,a,p]}class sr extends Ce{constructor(e){super(),Me(this,e,ir,or,_e,{asChild:1,el:0,thumb:5})}}const ar=n=>({builder:n&4}),Ct=n=>({builder:n[2]});function lr(n){let e,r,t,o=[n[2],n[3]],i={};for(let a=0;a<o.length;a+=1)i=ie(i,o[a]);return{c(){e=z("span"),this.h()},l(a){e=R(a,"SPAN",{}),B(e).forEach(M),this.h()},h(){Ee(e,i)},m(a,c){H(a,e,c),n[7](e),r||(t=Ye(n[2].action(e)),r=!0)},p(a,c){Ee(e,i=Xe(o,[c&4&&a[2],c&8&&a[3]]))},i:se,o:se,d(a){a&&M(e),n[7](null),r=!1,t()}}}function cr(n){let e;const r=n[6].default,t=xe(r,n,n[5],Ct);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&36)&&ye(t,r,o,o[5],e?ke(r,o[5],i,ar):De(o[5]),Ct)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}function ur(n){let e,r,t,o;const i=[cr,lr],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=i[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),H(s,t,l),o=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=i[e](s),r.c()),k(r,1),r.m(t.parentNode,t))},i(s){o||(k(r),o=!0)},o(s){P(r),o=!1},d(s){s&&M(t),a[e].d(s)}}}function fr(n,e,r){let t;const o=["asChild","el","tick"];let i=be(e,o),{$$slots:a={},$$scope:c}=e,{asChild:s=!1}=e,{el:l=void 0}=e,{tick:u}=e;const{getAttrs:f}=ut(),m=f("tick");function d(p){Ne[p?"unshift":"push"](()=>{l=p,r(0,l)})}return n.$$set=p=>{e=ie(ie({},e),Ve(p)),r(3,i=be(e,o)),"asChild"in p&&r(1,s=p.asChild),"el"in p&&r(0,l=p.el),"tick"in p&&r(4,u=p.tick),"$$scope"in p&&r(5,c=p.$$scope)},n.$$.update=()=>{n.$$.dirty&16&&r(2,t=u),n.$$.dirty&4&&Object.assign(t,m)},[l,s,t,i,u,c,a,d]}class dr extends Ce{constructor(e){super(),Me(this,e,fr,ur,_e,{asChild:1,el:0,tick:4})}}const mr=ln,hr=!0,ti=Object.freeze(Object.defineProperty({__proto__:null,csr:mr,prerender:hr},Symbol.toStringTag,{value:"Module"}));function pr(n){let e,r='<img src="res/joystick-base.png" class="mx-auto pt-8"/> <div id="stick" class="relative overflow-hidden left-[4rem] top-[-6rem]"><div class="w-16 h-16 rounded-[2rem] bg-neutral-700 shadow-2xl overflow-hidden"></div></div>';return{c(){e=z("div"),e.innerHTML=r,this.h()},l(t){e=R(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-19l2o9x"&&(e.innerHTML=r),this.h()},h(){T(e,"class","w-48 h-48 overflow-hidden")},m(t,o){H(t,e,o)},p:se,i:se,o:se,d(t){t&&M(e)}}}function vr(n,e,r){let t,o,i,a=!1,{maxDistance:c=64}=e,{deadzone:s=8}=e,{value:l=ve({x:0,y:0})}=e;function u(d){t!=null&&(a=!0,t.style.transition="0s",d.preventDefault(),d instanceof TouchEvent?(o={x:d.changedTouches[0].clientX,y:d.changedTouches[0].clientY},i=d.changedTouches[0].identifier):o={x:d.clientX,y:d.clientY})}function f(d){if(!a||t==null)return;let p=0,h=0,x=null;if(d instanceof TouchEvent){for(let b=0;b<d.changedTouches.length;b++)i==d.changedTouches[b].identifier&&(x=b,p=d.changedTouches[b].clientX,h=d.changedTouches[b].clientY);if(x==null)return}else p=d.clientX,h=d.clientY;const O=p-o.x,F=h-o.y,D=Math.atan2(F,O),w=Math.min(c,Math.hypot(O,F)),L=w*Math.cos(D),Z=w*Math.sin(D);t.style.transform=`translate3d(${L}px, ${Z}px, 0px)`;const v=w<s?0:c/(c-s)*(w-s),C=v*Math.cos(D),I=v*Math.sin(D),N=parseFloat((C/c).toFixed(4)),g=parseFloat((I/c).toFixed(4));l.set({x:N,y:g})}function m(d){!a||t==null||d instanceof TouchEvent&&i!=d.changedTouches[0].identifier||(t.style.transition=".2s",t.style.transform="translate3d(0px, 0px, 0px)",l.set({x:0,y:0}),i=null,a=!1)}return Ke(()=>{t=document.getElementById("stick"),t.addEventListener("mousedown",u),t.addEventListener("touchstart",u),document.addEventListener("mousemove",f,{passive:!1}),document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("mouseup",m),document.addEventListener("touchend",m)}),n.$$set=d=>{"maxDistance"in d&&r(0,c=d.maxDistance),"deadzone"in d&&r(1,s=d.deadzone),"value"in d&&r(2,l=d.value)},[c,s,l]}class gr extends Ce{constructor(e){super(),Me(this,e,vr,pr,_e,{maxDistance:0,deadzone:1,value:2})}}const br=(n,e)=>{const r=Wt(n,i=>i);let t;const o=r.subscribe(async i=>{t&&t();const a=await e(i);a&&(t=a)});Oe(()=>{o(),t&&t()})},Yt=new Nn(75,0,.1,1e3);Yt.position.z=5;Yt.lookAt(0,0,0);function Kt(n,e){const r=ve(n);let t=n;const o=r.subscribe(c=>t=c);return Oe(o),{...r,set:c=>{if((c==null?void 0:c.uuid)===(t==null?void 0:t.uuid))return;const s=t;r.set(c),e==null||e(c,s)},update:c=>{const s=c(t);if((s==null?void 0:s.uuid)===(t==null?void 0:t.uuid))return;const l=t;r.set(s),e==null||e(s,l)}}}const Je=()=>{const n=we("threlte");if(n===void 0)throw new Error("No Threlte context found, are you using this hook inside of <Canvas>?");return n},ft=Symbol("threlte-hierarchical-parent-context"),Xt=()=>we(ft),_r=n=>Re(ft,n),xr=n=>{const e=Kt(n);return Re(ft,e),e};function yr(n){let e;const r=n[7].default,t=xe(r,n,n[6],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,[i]){t&&t.p&&(!e||i&64)&&ye(t,r,o,o[6],e?ke(r,o[6],i,null):De(o[6]),null)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}const Dr=()=>({onChildMount:we("threlte-hierarchical-object-on-mount"),onChildDestroy:we("threlte-hierarchical-object-on-destroy")});function kr(n,e,r){var x;let t,{$$slots:o={},$$scope:i}=e,{object:a=void 0}=e,{onChildMount:c=void 0}=e;const s=O=>{c==null||c(O)};let{onChildDestroy:l=void 0}=e;const u=O=>{l==null||l(O)},{invalidate:f}=Je(),m=Xt();de(n,m,O=>r(5,t=O));let{parent:d=t}=e;const p=Dr();a&&((x=p.onChildMount)==null||x.call(p,a),f());const h=Kt(a,(O,F)=>{var D,w;F&&((D=p.onChildDestroy)==null||D.call(p,F),f()),O&&((w=p.onChildMount)==null||w.call(p,O),f())});return Oe(()=>{var O;a&&((O=p.onChildDestroy)==null||O.call(p,a),f())}),Re("threlte-hierarchical-object-on-mount",s),Re("threlte-hierarchical-object-on-destroy",u),_r(h),n.$$set=O=>{"object"in O&&r(2,a=O.object),"onChildMount"in O&&r(3,c=O.onChildMount),"onChildDestroy"in O&&r(4,l=O.onChildDestroy),"parent"in O&&r(1,d=O.parent),"$$scope"in O&&r(6,i=O.$$scope)},n.$$.update=()=>{n.$$.dirty&32&&r(1,d=t),n.$$.dirty&4&&h.set(a)},[m,d,a,c,l,t,i,o]}class Cr extends Ce{constructor(e){super(),Me(this,e,kr,yr,_e,{object:2,onChildMount:3,onChildDestroy:4,parent:1})}}function Mr(n){let e;const r=n[1].default,t=xe(r,n,n[4],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&16)&&ye(t,r,o,o[4],e?ke(r,o[4],i,null):De(o[4]),null)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}function Pr(n){let e,r;return e=new Cr({props:{object:n[0],onChildMount:n[2],onChildDestroy:n[3],$$slots:{default:[Mr]},$$scope:{ctx:n}}}),{c(){Y(e.$$.fragment)},l(t){K(e.$$.fragment,t)},m(t,o){X(e,t,o),r=!0},p(t,[o]){const i={};o&1&&(i.object=t[0]),o&1&&(i.onChildMount=t[2]),o&1&&(i.onChildDestroy=t[3]),o&16&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function wr(n,e,r){let{$$slots:t={},$$scope:o}=e,{object:i}=e;const a=s=>i.add(s),c=s=>i.remove(s);return n.$$set=s=>{"object"in s&&r(0,i=s.object),"$$scope"in s&&r(4,o=s.$$scope)},[i,t,a,c,o]}class Er extends Ce{constructor(e){super(),Me(this,e,wr,Pr,_e,{object:0})}}const Ir=()=>we("threlte-internal-context");function Or(n){let e;const r=n[9].default,t=xe(r,n,n[8],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,[i]){t&&t.p&&(!e||i&256)&&ye(t,r,o,o[8],e?ke(r,o[8],i,null):De(o[8]),null)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}const Mt="threlte-disposable-object-context";function Sr(n,e,r){let t,o,{$$slots:i={},$$scope:a}=e;const{collectDisposableObjects:c,addDisposableObjects:s,removeDisposableObjects:l}=Ir();let{object:u=void 0}=e,f=u,{dispose:m=void 0}=e;const d=we(Mt);de(n,d,x=>r(7,o=x));const p=ve(m??o??!0);de(n,p,x=>r(6,t=x)),Re(Mt,p);let h=t?c(u):[];return s(h),Oe(()=>{l(h)}),n.$$set=x=>{"object"in x&&r(2,u=x.object),"dispose"in x&&r(3,m=x.dispose),"$$scope"in x&&r(8,a=x.$$scope)},n.$$.update=()=>{n.$$.dirty&136&&p.set(m??o??!0),n.$$.dirty&116&&u!==f&&(l(h),r(5,h=t?c(u):[]),s(h),r(4,f=u))},[d,p,u,m,f,h,t,o,a,i]}class Tr extends Ce{constructor(e){super(),Me(this,e,Sr,Or,_e,{object:2,dispose:3})}}const Nr=/^\s*class\s+/,Ar=n=>typeof n!="function"?!1:Nr.test(n.toString()),zr=n=>Array.isArray(n),Pt=(n,e)=>Ar(n)?zr(e)?new n(...e):new n:n,Rr=n=>"isObject3D"in n,wt=n=>"dispose"in n,Jt=(n,e)=>{if(e.includes(".")){const r=e.split("."),t=r.pop();for(let o=0;o<r.length;o+=1)n=n[r[o]];return{target:n,key:t}}else return{target:n,key:e}},it=Symbol("initialValueBeforeAttach"),Vr=()=>{const{invalidate:n}=Je();let e=!1,r=it,t,o,i;const a=(s,l,u)=>{if(c(),!u){const f=s;((f==null?void 0:f.isMaterial)||!1)&&(u="material"),((f==null?void 0:f.isBufferGeometry)||(f==null?void 0:f.isGeometry)||!1)&&(u="geometry")}if(u){if(typeof u=="function")t=u(l,s);else{const{target:f,key:m}=Jt(l,u);r=f[m],f[m]=s,o=f,i=m}e=!0,n()}},c=()=>{e&&(t?(t(),t=void 0):o&&i&&r!==it&&(o[i]=r,r=it,o=void 0,i=void 0),e=!1,n())};return Oe(()=>{c()}),{update:a}},jr=n=>n&&n.isCamera,Qt=n=>n&&n.isOrthographicCamera,$t=n=>n&&n.isPerspectiveCamera,Fr=n=>$t(n)||Qt(n),Br=()=>{const{invalidate:n,size:e,camera:r}=Je();let t,o;Oe(()=>{o==null||o()});const i=s=>{t&&(Qt(t)?(t.left=s.width/-2,t.right=s.width/2,t.top=s.height/2,t.bottom=s.height/-2,t.updateProjectionMatrix(),t.updateMatrixWorld(),n()):$t(t)&&(t.aspect=s.width/s.height,t.updateProjectionMatrix(),t.updateMatrixWorld(),n()))};return{update:(s,l)=>{if(o==null||o(),l||!Fr(s)){t=void 0;return}t=s,o=e.subscribe(i)},makeDefaultCamera:(s,l)=>{!jr(s)||!l||(r.set(s),n())}}},en=()=>{const n=Ht(),e=(t,o)=>{const i=n.$$.callbacks[t];i&&i.forEach(a=>{a(o)})};return Object.defineProperty(e,"hasEventListener",{value:t=>!!n.$$.callbacks[t],enumerable:!0}),e},Hr=()=>{const n=en(),e=[];let r,t=!1;const o=()=>{e.forEach(c=>c()),e.length=0,n("create",{ref:r,cleanup:c=>{e.push(c)}})},i=a=>{r=a,t&&o()};return Ke(()=>{o(),t=!0}),Oe(()=>{e.forEach(a=>a())}),{updateRef:i}},Et=n=>!!(n!=null&&n.addEventListener),Lr=()=>{const n=en(),e=Ht(),r=s=>{s!=null&&s.type&&n(s.type,s)},t=(s,l)=>{Et(s)&&l.forEach(u=>{s.removeEventListener(u,r)})},o=(s,l)=>{Et(s)&&l.forEach(u=>{s.addEventListener(u,r)})},i=ve(),a=ve([]);return br([i,a],([s,l])=>(o(s,l),()=>t(s,l))),Ke(()=>{a.set(Object.keys(e.$$.callbacks))}),{updateRef:s=>{i.set(s)}}},Gr=n=>{const r=we("threlte-plugin-context");if(!r)return;const t=Object.values(r).map(l=>l(n)).filter(Boolean),o=t.flatMap(l=>l.pluginProps??[]);let i=[];return Oe(()=>{i.forEach(l=>l())}),{updateRef:l=>{i.forEach(u=>u()),i=[],t.forEach(u=>{var m;const f=(m=u.onRefChange)==null?void 0:m.call(u,l);f&&i.push(f)})},updateProps:l=>{t.forEach(u=>{var f;(f=u.onPropsChange)==null||f.call(u,l)})},updateRestProps:l=>{t.forEach(u=>{var f;(f=u.onRestPropsChange)==null||f.call(u,l)})},pluginsProps:o}},Wr=new Set(["$$scope","$$slots","type","args","attach","instance"]),Zr=new Set(["fov","aspect","near","far","left","right","top","bottom","zoom"]),Ur=n=>typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n>"u"||n===null,It=(n,e,r)=>{var t,o,i;return!Array.isArray(r)&&typeof r=="number"&&typeof((t=n[e])==null?void 0:t.setScalar)=="function"&&!((o=n[e])!=null&&o.isColor)?(a,c,s)=>{a[c].setScalar(s)}:typeof((i=n[e])==null?void 0:i.set)=="function"?Array.isArray(r)?(a,c,s)=>{a[c].set(...s)}:(a,c,s)=>{a[c].set(s)}:(a,c,s)=>{a[c]=s}},qr=()=>{const{invalidate:n}=Je(),e=new Map,r=new Map,t=(i,a,c,s)=>{if(Ur(c)){const f=e.get(a);if(f&&f.instance===i&&f.value===c)return;e.set(a,{instance:i,value:c})}const{key:l,target:u}=Jt(i,a);if(c!=null){const f=r.get(a);if(f)f(u,l,c);else{const m=It(u,l,c);r.set(a,m),m(u,l,c)}}else It(u,l,c)(u,l,c);s.manualCamera||Zr.has(l)&&(u.isPerspectiveCamera||u.isOrthographicCamera)&&u.updateProjectionMatrix()};return{updateProps:(i,a,c)=>{var s;for(const l in a)!Wr.has(l)&&!((s=c.pluginsProps)!=null&&s.includes(l))&&t(i,l,a[l],c),n()}}},Yr=n=>({ref:n&2}),Ot=n=>({ref:n[1]}),Kr=n=>({ref:n&2}),St=n=>({ref:n[1]});function Tt(n){let e,r;return e=new Tr({props:{object:n[1],dispose:n[0]}}),{c(){Y(e.$$.fragment)},l(t){K(e.$$.fragment,t)},m(t,o){X(e,t,o),r=!0},p(t,o){const i={};o&2&&(i.object=t[1]),o&1&&(i.dispose=t[0]),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Xr(n){let e;const r=n[10].default,t=xe(r,n,n[11],Ot);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&2050)&&ye(t,r,o,o[11],e?ke(r,o[11],i,Yr):De(o[11]),Ot)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}function Jr(n){let e,r;return e=new Er({props:{object:n[1],$$slots:{default:[Qr]},$$scope:{ctx:n}}}),{c(){Y(e.$$.fragment)},l(t){K(e.$$.fragment,t)},m(t,o){X(e,t,o),r=!0},p(t,o){const i={};o&2&&(i.object=t[1]),o&2050&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Qr(n){let e;const r=n[10].default,t=xe(r,n,n[11],St);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&2050)&&ye(t,r,o,o[11],e?ke(r,o[11],i,Kr):De(o[11]),St)},i(o){e||(k(t,o),e=!0)},o(o){P(t,o),e=!1},d(o){t&&t.d(o)}}}function $r(n){let e=wt(n[1]),r,t,o,i,a,c,s=e&&Tt(n);const l=[Jr,Xr],u=[];function f(m,d){return d&2&&(t=null),t==null&&(t=!!Rr(m[1])),t?0:1}return o=f(n,-1),i=u[o]=l[o](n),{c(){s&&s.c(),r=$(),i.c(),a=ue()},l(m){s&&s.l(m),r=ee(m),i.l(m),a=ue()},m(m,d){s&&s.m(m,d),H(m,r,d),u[o].m(m,d),H(m,a,d),c=!0},p(m,[d]){d&2&&(e=wt(m[1])),e?s?(s.p(m,d),d&2&&k(s,1)):(s=Tt(m),s.c(),k(s,1),s.m(r.parentNode,r)):s&&(me(),P(s,1,1,()=>{s=null}),he());let p=o;o=f(m,d),o===p?u[o].p(m,d):(me(),P(u[p],1,1,()=>{u[p]=null}),he(),i=u[o],i?i.p(m,d):(i=u[o]=l[o](m),i.c()),k(i,1),i.m(a.parentNode,a))},i(m){c||(k(s),k(i),c=!0)},o(m){P(s),P(i),c=!1},d(m){m&&(M(r),M(a)),s&&s.d(m),u[o].d(m)}}}function eo(n,e,r){const t=["is","args","attach","manual","makeDefault","dispose","ref"];let o=be(e,t),i,{$$slots:a={},$$scope:c}=e,{is:s}=e,{args:l=void 0}=e,{attach:u=void 0}=e,{manual:f=void 0}=e,{makeDefault:m=void 0}=e,{dispose:d=void 0}=e;const p=Xt();de(n,p,g=>r(9,i=g));const h=Hr();let x=Pt(s,l);h.updateRef(x);let O=!1;const F=()=>{if(!O){O=!0;return}r(1,x=Pt(s,l)),h.updateRef(x)};let{ref:D=x}=e;const w=xr(x),L=Gr({ref:x,props:e}),Z=(L==null?void 0:L.pluginsProps)??[],v=qr(),C=Br(),I=Vr(),N=Lr();return n.$$set=g=>{r(23,e=ie(ie({},e),Ve(g))),r(22,o=be(e,t)),"is"in g&&r(4,s=g.is),"args"in g&&r(5,l=g.args),"attach"in g&&r(6,u=g.attach),"manual"in g&&r(7,f=g.manual),"makeDefault"in g&&r(8,m=g.makeDefault),"dispose"in g&&r(0,d=g.dispose),"ref"in g&&r(3,D=g.ref),"$$scope"in g&&r(11,c=g.$$scope)},n.$$.update=()=>{n.$$.dirty&48&&F(),n.$$.dirty&2&&r(3,D=x),n.$$.dirty&2&&w.set(x),v.updateProps(x,o,{manualCamera:f,pluginsProps:Z}),n.$$.dirty&130&&C.update(x,f),n.$$.dirty&258&&C.makeDefaultCamera(x,m),n.$$.dirty&578&&I.update(x,i,u),n.$$.dirty&2&&N.updateRef(x),n.$$.dirty&2&&(L==null||L.updateRef(x)),L==null||L.updateProps(e),L==null||L.updateRestProps(o)},e=Ve(e),[d,x,p,D,s,l,u,f,m,i,a,c]}class tn extends Ce{constructor(e){super(),Me(this,e,eo,$r,_e,{is:4,args:5,attach:6,manual:7,makeDefault:8,dispose:0,ref:3})}}const to={},no=(n,e)=>{const r=to[e]||An[e];if(!r)throw new Error(`No Three.js module found for ${e}. Did you forget to extend the catalogue?`);return{...n,props:{...n.props,is:r}}},ro=n=>new Proxy(class{},{construct(e,[r]){const t=r;return new tn(no(t,n))}});new Proxy(class{},{construct(n,[e]){const r=e;return new tn(r)},get(n,e){return ro(e)}});new ct;new ct;new ct;new Zt;new Zt;new zn;`${ge.logdepthbuf_pars_vertex}${ge.fog_pars_vertex}${ge.logdepthbuf_vertex}${ge.fog_vertex}`;`${ge.tonemapping_fragment}${ge.colorspace_fragment}`;`${ge.tonemapping_fragment}${ge.colorspace_fragment}`;const oo=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,io=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,so=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,ao=so,lo=`
	${oo}
	${io}
`;`${ao}${lo}${ge.tonemapping_fragment}${ge.colorspace_fragment}`;for(let n=0;n<256;n++)(n<16?"0":"")+n.toString(16);var nn={exports:{}};nn.exports=Qe;nn.exports.default=Qe;function Qe(n,e,r){r=r||2;var t=e&&e.length,o=t?e[0]*r:n.length,i=rn(n,0,o,r,!0),a=[];if(!i||i.next===i.prev)return a;var c,s,l,u,f,m,d;if(t&&(i=ho(n,e,i,r)),n.length>80*r){c=l=n[0],s=u=n[1];for(var p=r;p<o;p+=r)f=n[p],m=n[p+1],f<c&&(c=f),m<s&&(s=m),f>l&&(l=f),m>u&&(u=m);d=Math.max(l-c,u-s),d=d!==0?32767/d:0}return je(i,a,r,c,s,d,0),a}function rn(n,e,r,t,o){var i,a;if(o===lt(n,e,r,t)>0)for(i=e;i<r;i+=t)a=Nt(i,n[i],n[i+1],a);else for(i=r-t;i>=e;i-=t)a=Nt(i,n[i],n[i+1],a);return a&&$e(a,a.next)&&(Be(a),a=a.next),a}function Te(n,e){if(!n)return n;e||(e=n);var r=n,t;do if(t=!1,!r.steiner&&($e(r,r.next)||q(r.prev,r,r.next)===0)){if(Be(r),r=e=r.prev,r===r.next)break;t=!0}else r=r.next;while(t||r!==e);return e}function je(n,e,r,t,o,i,a){if(n){!a&&i&&_o(n,t,o,i);for(var c=n,s,l;n.prev!==n.next;){if(s=n.prev,l=n.next,i?uo(n,t,o,i):co(n)){e.push(s.i/r|0),e.push(n.i/r|0),e.push(l.i/r|0),Be(n),n=l.next,c=l.next;continue}if(n=l,n===c){a?a===1?(n=fo(Te(n),e,r),je(n,e,r,t,o,i,2)):a===2&&mo(n,e,r,t,o,i):je(Te(n),e,r,t,o,i,1);break}}}}function co(n){var e=n.prev,r=n,t=n.next;if(q(e,r,t)>=0)return!1;for(var o=e.x,i=r.x,a=t.x,c=e.y,s=r.y,l=t.y,u=o<i?o<a?o:a:i<a?i:a,f=c<s?c<l?c:l:s<l?s:l,m=o>i?o>a?o:a:i>a?i:a,d=c>s?c>l?c:l:s>l?s:l,p=t.next;p!==e;){if(p.x>=u&&p.x<=m&&p.y>=f&&p.y<=d&&ze(o,c,i,s,a,l,p.x,p.y)&&q(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function uo(n,e,r,t){var o=n.prev,i=n,a=n.next;if(q(o,i,a)>=0)return!1;for(var c=o.x,s=i.x,l=a.x,u=o.y,f=i.y,m=a.y,d=c<s?c<l?c:l:s<l?s:l,p=u<f?u<m?u:m:f<m?f:m,h=c>s?c>l?c:l:s>l?s:l,x=u>f?u>m?u:m:f>m?f:m,O=st(d,p,e,r,t),F=st(h,x,e,r,t),D=n.prevZ,w=n.nextZ;D&&D.z>=O&&w&&w.z<=F;){if(D.x>=d&&D.x<=h&&D.y>=p&&D.y<=x&&D!==o&&D!==a&&ze(c,u,s,f,l,m,D.x,D.y)&&q(D.prev,D,D.next)>=0||(D=D.prevZ,w.x>=d&&w.x<=h&&w.y>=p&&w.y<=x&&w!==o&&w!==a&&ze(c,u,s,f,l,m,w.x,w.y)&&q(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;D&&D.z>=O;){if(D.x>=d&&D.x<=h&&D.y>=p&&D.y<=x&&D!==o&&D!==a&&ze(c,u,s,f,l,m,D.x,D.y)&&q(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;w&&w.z<=F;){if(w.x>=d&&w.x<=h&&w.y>=p&&w.y<=x&&w!==o&&w!==a&&ze(c,u,s,f,l,m,w.x,w.y)&&q(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function fo(n,e,r){var t=n;do{var o=t.prev,i=t.next.next;!$e(o,i)&&on(o,t,t.next,i)&&Fe(o,i)&&Fe(i,o)&&(e.push(o.i/r|0),e.push(t.i/r|0),e.push(i.i/r|0),Be(t),Be(t.next),t=n=i),t=t.next}while(t!==n);return Te(t)}function mo(n,e,r,t,o,i){var a=n;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&Do(a,c)){var s=sn(a,c);a=Te(a,a.next),s=Te(s,s.next),je(a,e,r,t,o,i,0),je(s,e,r,t,o,i,0);return}c=c.next}a=a.next}while(a!==n)}function ho(n,e,r,t){var o=[],i,a,c,s,l;for(i=0,a=e.length;i<a;i++)c=e[i]*t,s=i<a-1?e[i+1]*t:n.length,l=rn(n,c,s,t,!1),l===l.next&&(l.steiner=!0),o.push(yo(l));for(o.sort(po),i=0;i<o.length;i++)r=vo(o[i],r);return r}function po(n,e){return n.x-e.x}function vo(n,e){var r=go(n,e);if(!r)return e;var t=sn(r,n);return Te(t,t.next),Te(r,r.next)}function go(n,e){var r=e,t=n.x,o=n.y,i=-1/0,a;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var c=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(c<=t&&c>i&&(i=c,a=r.x<r.next.x?r:r.next,c===t))return a}r=r.next}while(r!==e);if(!a)return null;var s=a,l=a.x,u=a.y,f=1/0,m;r=a;do t>=r.x&&r.x>=l&&t!==r.x&&ze(o<u?t:i,o,l,u,o<u?i:t,o,r.x,r.y)&&(m=Math.abs(o-r.y)/(t-r.x),Fe(r,n)&&(m<f||m===f&&(r.x>a.x||r.x===a.x&&bo(a,r)))&&(a=r,f=m)),r=r.next;while(r!==s);return a}function bo(n,e){return q(n.prev,n,e.prev)<0&&q(e.next,n,n.next)<0}function _o(n,e,r,t){var o=n;do o.z===0&&(o.z=st(o.x,o.y,e,r,t)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==n);o.prevZ.nextZ=null,o.prevZ=null,xo(o)}function xo(n){var e,r,t,o,i,a,c,s,l=1;do{for(r=n,n=null,i=null,a=0;r;){for(a++,t=r,c=0,e=0;e<l&&(c++,t=t.nextZ,!!t);e++);for(s=l;c>0||s>0&&t;)c!==0&&(s===0||!t||r.z<=t.z)?(o=r,r=r.nextZ,c--):(o=t,t=t.nextZ,s--),i?i.nextZ=o:n=o,o.prevZ=i,i=o;r=t}i.nextZ=null,l*=2}while(a>1);return n}function st(n,e,r,t,o){return n=(n-r)*o|0,e=(e-t)*o|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function yo(n){var e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function ze(n,e,r,t,o,i,a,c){return(o-a)*(e-c)>=(n-a)*(i-c)&&(n-a)*(t-c)>=(r-a)*(e-c)&&(r-a)*(i-c)>=(o-a)*(t-c)}function Do(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!ko(n,e)&&(Fe(n,e)&&Fe(e,n)&&Co(n,e)&&(q(n.prev,n,e.prev)||q(n,e.prev,e))||$e(n,e)&&q(n.prev,n,n.next)>0&&q(e.prev,e,e.next)>0)}function q(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function $e(n,e){return n.x===e.x&&n.y===e.y}function on(n,e,r,t){var o=Ue(q(n,e,r)),i=Ue(q(n,e,t)),a=Ue(q(r,t,n)),c=Ue(q(r,t,e));return!!(o!==i&&a!==c||o===0&&Ze(n,r,e)||i===0&&Ze(n,t,e)||a===0&&Ze(r,n,t)||c===0&&Ze(r,e,t))}function Ze(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Ue(n){return n>0?1:n<0?-1:0}function ko(n,e){var r=n;do{if(r.i!==n.i&&r.next.i!==n.i&&r.i!==e.i&&r.next.i!==e.i&&on(r,r.next,n,e))return!0;r=r.next}while(r!==n);return!1}function Fe(n,e){return q(n.prev,n,n.next)<0?q(n,e,n.next)>=0&&q(n,n.prev,e)>=0:q(n,e,n.prev)<0||q(n,n.next,e)<0}function Co(n,e){var r=n,t=!1,o=(n.x+e.x)/2,i=(n.y+e.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(t=!t),r=r.next;while(r!==n);return t}function sn(n,e){var r=new at(n.i,n.x,n.y),t=new at(e.i,e.x,e.y),o=n.next,i=e.prev;return n.next=e,e.prev=n,r.next=o,o.prev=r,t.next=r,r.prev=t,i.next=t,t.prev=i,t}function Nt(n,e,r,t){var o=new at(n,e,r);return t?(o.next=t.next,o.prev=t,t.next.prev=o,t.next=o):(o.prev=o,o.next=o),o}function Be(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function at(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Qe.deviation=function(n,e,r,t){var o=e&&e.length,i=o?e[0]*r:n.length,a=Math.abs(lt(n,0,i,r));if(o)for(var c=0,s=e.length;c<s;c++){var l=e[c]*r,u=c<s-1?e[c+1]*r:n.length;a-=Math.abs(lt(n,l,u,r))}var f=0;for(c=0;c<t.length;c+=3){var m=t[c]*r,d=t[c+1]*r,p=t[c+2]*r;f+=Math.abs((n[m]-n[p])*(n[d+1]-n[m+1])-(n[m]-n[d])*(n[p+1]-n[m+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)};function lt(n,e,r,t){for(var o=0,i=e,a=r-t;i<r;i+=t)o+=(n[a]-n[i])*(n[i+1]+n[a+1]),a=i;return o}Qe.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},t=0,o=0;o<n.length;o++){for(var i=0;i<n[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(n[o][i][a]);o>0&&(t+=n[o-1].length,r.holes.push(t))}return r};new Ut;new Ut;var At;(n=>{function e(o){let i=o.slice();return i.sort(n.POINT_COMPARATOR),n.makeHullPresorted(i)}n.makeHull=e;function r(o){if(o.length<=1)return o.slice();let i=[];for(let c=0;c<o.length;c++){const s=o[c];for(;i.length>=2;){const l=i[i.length-1],u=i[i.length-2];if((l.x-u.x)*(s.y-u.y)>=(l.y-u.y)*(s.x-u.x))i.pop();else break}i.push(s)}i.pop();let a=[];for(let c=o.length-1;c>=0;c--){const s=o[c];for(;a.length>=2;){const l=a[a.length-1],u=a[a.length-2];if((l.x-u.x)*(s.y-u.y)>=(l.y-u.y)*(s.x-u.x))a.pop();else break}a.push(s)}return a.pop(),i.length==1&&a.length==1&&i[0].x==a[0].x&&i[0].y==a[0].y?i:i.concat(a)}n.makeHullPresorted=r;function t(o,i){return o.x<i.x?-1:o.x>i.x?1:o.y<i.y?-1:o.y>i.y?1:0}n.POINT_COMPARATOR=t})(At||(At={}));function zt(n,e,r){const t=n.slice();return t[24]=e[r],t}function Rt(n,e,r){const t=n.slice();return t[27]=e[r],t}function Vt(n){let e,r;return e=new qe({props:{class:"py-3 px-4 mx-2 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-slate-50 text-gray-800 hover:bg-gray-300 focus:outline-none focus:ring-2 ring-meadow-600 ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",$$slots:{default:[Mo]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){Y(e.$$.fragment)},l(t){K(e.$$.fragment,t)},m(t,o){X(e,t,o),r=!0},p(t,o){const i={};o&1073741824&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Mo(n){let e,r,t;return e=new Pe({props:{id:"flag",size:"1rem",color:"",fill:"0"}}),{c(){Y(e.$$.fragment),r=dn(`
				Add waypoint`)},l(o){K(e.$$.fragment,o),r=mn(o,`
				Add waypoint`)},m(o,i){X(e,o,i),H(o,r,i),t=!0},p:se,i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){P(e.$$.fragment,o),t=!1},d(o){o&&M(r),J(e,o)}}}function jt(n){let e,r,t,o,i,a;function c(l){n[13](l)}let s={};return n[3]!==void 0&&(s.value=n[3]),r=new gr({props:s}),Ne.push(()=>Gt(r,"value",c)),{c(){e=z("div"),Y(r.$$.fragment),this.h()},l(l){e=R(l,"DIV",{id:!0,class:!0});var u=B(e);K(r.$$.fragment,u),u.forEach(M),this.h()},h(){T(e,"id","joystick-container"),T(e,"class","m-4 mb-0 mx-auto"),oe(e,"opacity-50",n[5]!=Se.CONNECTED)},m(l,u){H(l,e,u),X(r,e,null),a=!0},p(l,u){const f={};!t&&u&8&&(t=!0,f.value=l[3],Lt(()=>t=!1)),r.$set(f),(!a||u&32)&&oe(e,"opacity-50",l[5]!=Se.CONNECTED)},i(l){a||(k(r.$$.fragment,l),l&&hn(()=>{a&&(i&&i.end(1),o=pn(e,_t,{duration:100,y:10}),o.start())}),a=!0)},o(l){P(r.$$.fragment,l),o&&o.invalidate(),l&&(i=vn(e,_t,{duration:100,y:10})),a=!1},d(l){l&&M(e),J(r),l&&i&&i.end()}}}function Ft(n){let e,r;return e=new sr({props:{thumb:n[27],class:"block size-[25px] cursor-pointer rounded-full border border-border-input bg-white shadow  transition-colors hover:border-dark-40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 active:scale-98 disabled:pointer-events-none disabled:opacity-50 dark:bg-foreground dark:shadow-card"}}),{c(){Y(e.$$.fragment)},l(t){K(e.$$.fragment,t)},m(t,o){X(e,t,o),r=!0},p(t,o){const i={};o&4194304&&(i.thumb=t[27]),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Bt(n){let e,r;return e=new dr({props:{tick:n[24]}}),{c(){Y(e.$$.fragment)},l(t){K(e.$$.fragment,t)},m(t,o){X(e,t,o),r=!0},p(t,o){const i={};o&8388608&&(i.tick=t[24]),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Po(n){let e,r,t,o,i,a;r=new er({props:{class:"absolute h-full bg-foreground"}});let c=He(n[22]),s=[];for(let d=0;d<c.length;d+=1)s[d]=Ft(Rt(n,c,d));const l=d=>P(s[d],1,1,()=>{s[d]=null});let u=He(n[23]),f=[];for(let d=0;d<u.length;d+=1)f[d]=Bt(zt(n,u,d));const m=d=>P(f[d],1,1,()=>{f[d]=null});return{c(){e=z("span"),Y(r.$$.fragment),t=$();for(let d=0;d<s.length;d+=1)s[d].c();o=$();for(let d=0;d<f.length;d+=1)f[d].c();i=ue(),this.h()},l(d){e=R(d,"SPAN",{class:!0});var p=B(e);K(r.$$.fragment,p),p.forEach(M),t=ee(d);for(let h=0;h<s.length;h+=1)s[h].l(d);o=ee(d);for(let h=0;h<f.length;h+=1)f[h].l(d);i=ue(),this.h()},h(){T(e,"class","relative h-2 w-full grow overflow-hidden rounded-full bg-gray-800")},m(d,p){H(d,e,p),X(r,e,null),H(d,t,p);for(let h=0;h<s.length;h+=1)s[h]&&s[h].m(d,p);H(d,o,p);for(let h=0;h<f.length;h+=1)f[h]&&f[h].m(d,p);H(d,i,p),a=!0},p(d,p){if(p&4194304){c=He(d[22]);let h;for(h=0;h<c.length;h+=1){const x=Rt(d,c,h);s[h]?(s[h].p(x,p),k(s[h],1)):(s[h]=Ft(x),s[h].c(),k(s[h],1),s[h].m(o.parentNode,o))}for(me(),h=c.length;h<s.length;h+=1)l(h);he()}if(p&8388608){u=He(d[23]);let h;for(h=0;h<u.length;h+=1){const x=zt(d,u,h);f[h]?(f[h].p(x,p),k(f[h],1)):(f[h]=Bt(x),f[h].c(),k(f[h],1),f[h].m(i.parentNode,i))}for(me(),h=u.length;h<f.length;h+=1)m(h);he()}},i(d){if(!a){k(r.$$.fragment,d);for(let p=0;p<c.length;p+=1)k(s[p]);for(let p=0;p<u.length;p+=1)k(f[p]);a=!0}},o(d){P(r.$$.fragment,d),s=s.filter(Boolean);for(let p=0;p<s.length;p+=1)P(s[p]);f=f.filter(Boolean);for(let p=0;p<f.length;p+=1)P(f[p]);a=!1},d(d){d&&(M(e),M(t),M(o),M(i)),J(r),mt(s,d),mt(f,d)}}}function wo(n){let e,r,t,o,i,a,c;return r=new qe({props:{class:"transition-all pt-3 px-4 inline-flex items-center gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium focus:z-10 border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-slate-200 focus:outline-none focus:bg-slate-300 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800 dark:focus:bg-neutral-800",disabled:n[7]>2,$$slots:{default:[Oo]},$$scope:{ctx:n}}}),r.$on("click",n[9]),o=new qe({props:{class:"pt-3 px-4 inline-flex items-center gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium focus:z-10 border border-gray-200 bg-sky-100 text-sky-600 shadow-sm hover:bg-sky-200 focus:outline-none focus:bg-sky-300 transition-all disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800 dark:focus:bg-neutral-800",disabled:n[7]>1,$$slots:{default:[So]},$$scope:{ctx:n}}}),o.$on("click",n[10]),a=new qe({props:{class:"transition-all pt-3 px-4 inline-flex items-center gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium focus:z-10 border border-gray-200 bg-sand-300 text-gray-800 shadow-sm hover:bg-sand-400 focus:outline-none focus:bg-sand-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800 dark:focus:bg-neutral-800",$$slots:{default:[To]},$$scope:{ctx:n}}}),a.$on("click",n[11]),{c(){e=z("div"),Y(r.$$.fragment),t=$(),Y(o.$$.fragment),i=$(),Y(a.$$.fragment),this.h()},l(s){e=R(s,"DIV",{class:!0});var l=B(e);K(r.$$.fragment,l),t=ee(l),K(o.$$.fragment,l),i=ee(l),K(a.$$.fragment,l),l.forEach(M),this.h()},h(){T(e,"class","inline-flex rounded-lg shadow-sm m-4")},m(s,l){H(s,e,l),X(r,e,null),A(e,t),X(o,e,null),A(e,i),X(a,e,null),c=!0},p(s,l){const u={};l&128&&(u.disabled=s[7]>2),l&1073741888&&(u.$$scope={dirty:l,ctx:s}),r.$set(u);const f={};l&128&&(f.disabled=s[7]>1),l&1073741888&&(f.$$scope={dirty:l,ctx:s}),o.$set(f);const m={};l&1073741888&&(m.$$scope={dirty:l,ctx:s}),a.$set(m)},i(s){c||(k(r.$$.fragment,s),k(o.$$.fragment,s),k(a.$$.fragment,s),c=!0)},o(s){P(r.$$.fragment,s),P(o.$$.fragment,s),P(a.$$.fragment,s),c=!1},d(s){s&&M(e),J(r),J(o),J(a)}}}function Eo(n){let e,r,t,o,i,a="Out of Service",c;return t=new Pe({props:{id:"do_not_disturb_on",size:"1rem",color:""}}),{c(){e=z("div"),r=z("div"),Y(t.$$.fragment),o=$(),i=z("p"),i.textContent=a,this.h()},l(s){e=R(s,"DIV",{class:!0});var l=B(e);r=R(l,"DIV",{class:!0});var u=B(r);K(t.$$.fragment,u),o=ee(u),i=R(u,"P",{class:!0,"data-svelte-h":!0}),Ie(i)!=="svelte-1tigozn"&&(i.textContent=a),u.forEach(M),l.forEach(M),this.h()},h(){T(i,"class",""),T(r,"class","py-3 px-4 flex flex-row opacity-80 pointer-events-none justify-center w-48 gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium border border-gray-200 bg-slate-50 text-gray-800 shadow-sm"),T(e,"class","inline-flex rounded-lg my-4 mx-auto opacity-80")},m(s,l){H(s,e,l),A(e,r),X(t,r,null),A(r,o),A(r,i),c=!0},p:se,i(s){c||(k(t.$$.fragment,s),c=!0)},o(s){P(t.$$.fragment,s),c=!1},d(s){s&&M(e),J(t)}}}function Io(n){let e,r,t,o,i,a="Disconnected <br/>from Steward",c;return t=new Pe({props:{id:"link_off",size:"1.5rem",color:""}}),{c(){e=z("div"),r=z("div"),Y(t.$$.fragment),o=$(),i=z("p"),i.innerHTML=a,this.h()},l(s){e=R(s,"DIV",{class:!0});var l=B(e);r=R(l,"DIV",{class:!0});var u=B(r);K(t.$$.fragment,u),o=ee(u),i=R(u,"P",{class:!0,"data-svelte-h":!0}),Ie(i)!=="svelte-1s8zlll"&&(i.innerHTML=a),u.forEach(M),l.forEach(M),this.h()},h(){T(i,"class",""),T(r,"class","py-3 px-4 flex flex-row pointer-events-none justify-center w-48 gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium border border-gray-200 bg-slate-50 text-gray-800 shadow-sm"),T(e,"class","inline-flex rounded-lg my-4 mx-auto")},m(s,l){H(s,e,l),A(e,r),X(t,r,null),A(r,o),A(r,i),c=!0},p:se,i(s){c||(k(t.$$.fragment,s),c=!0)},o(s){P(t.$$.fragment,s),c=!1},d(s){s&&M(e),J(t)}}}function Oo(n){let e,r,t,o,i,a="Manual",c,s,l,u;return t=new Pe({props:{id:"search_hands_free",size:"1.5rem",color:"",fill:"0"}}),l=new Pe({props:{id:"circle",color:"#404943",size:"0.5rem"}}),{c(){e=z("div"),r=z("div"),Y(t.$$.fragment),o=$(),i=z("p"),i.textContent=a,c=$(),s=z("div"),Y(l.$$.fragment),this.h()},l(f){e=R(f,"DIV",{class:!0});var m=B(e);r=R(m,"DIV",{class:!0});var d=B(r);K(t.$$.fragment,d),o=ee(d),i=R(d,"P",{class:!0,"data-svelte-h":!0}),Ie(i)!=="svelte-f2dr5q"&&(i.textContent=a),d.forEach(M),c=ee(m),s=R(m,"DIV",{class:!0});var p=B(s);K(l.$$.fragment,p),p.forEach(M),m.forEach(M),this.h()},h(){T(i,"class","text-xs"),T(r,"class","flex flex-col"),oe(r,"animate-pulse",n[6]==re.TELEOP),T(s,"class","pb-1"),oe(s,"opacity-0",n[6]!=re.TELEOP),T(e,"class","flex flex-col")},m(f,m){H(f,e,m),A(e,r),X(t,r,null),A(r,o),A(r,i),A(e,c),A(e,s),X(l,s,null),u=!0},p(f,m){(!u||m&64)&&oe(r,"animate-pulse",f[6]==re.TELEOP),(!u||m&64)&&oe(s,"opacity-0",f[6]!=re.TELEOP)},i(f){u||(k(t.$$.fragment,f),k(l.$$.fragment,f),u=!0)},o(f){P(t.$$.fragment,f),P(l.$$.fragment,f),u=!1},d(f){f&&M(e),J(t),J(l)}}}function So(n){let e,r,t,o,i,a="Auto",c,s,l,u;return t=new Pe({props:{id:"smart_toy",size:"1.5rem",color:"",fill:"0"}}),l=new Pe({props:{id:"circle",color:"#404943",size:"0.5rem"}}),{c(){e=z("div"),r=z("div"),Y(t.$$.fragment),o=$(),i=z("p"),i.textContent=a,c=$(),s=z("div"),Y(l.$$.fragment),this.h()},l(f){e=R(f,"DIV",{class:!0});var m=B(e);r=R(m,"DIV",{class:!0});var d=B(r);K(t.$$.fragment,d),o=ee(d),i=R(d,"P",{class:!0,"data-svelte-h":!0}),Ie(i)!=="svelte-kz06vp"&&(i.textContent=a),d.forEach(M),c=ee(m),s=R(m,"DIV",{class:!0});var p=B(s);K(l.$$.fragment,p),p.forEach(M),m.forEach(M),this.h()},h(){T(i,"class","text-xs"),T(r,"class","flex flex-col"),oe(r,"animate-pulse",n[6]==re.AUTO),T(s,"class","pb-1"),oe(s,"opacity-0",n[6]!=re.AUTO),T(e,"class","flex flex-col")},m(f,m){H(f,e,m),A(e,r),X(t,r,null),A(r,o),A(r,i),A(e,c),A(e,s),X(l,s,null),u=!0},p(f,m){(!u||m&64)&&oe(r,"animate-pulse",f[6]==re.AUTO),(!u||m&64)&&oe(s,"opacity-0",f[6]!=re.AUTO)},i(f){u||(k(t.$$.fragment,f),k(l.$$.fragment,f),u=!0)},o(f){P(t.$$.fragment,f),P(l.$$.fragment,f),u=!1},d(f){f&&M(e),J(t),J(l)}}}function To(n){let e,r,t,o,i,a="Pause",c,s,l,u;return t=new Pe({props:{id:"pause",size:"1.5rem",color:"",fill:"0"}}),l=new Pe({props:{id:"circle",color:"#404943",size:"0.5rem"}}),{c(){e=z("div"),r=z("div"),Y(t.$$.fragment),o=$(),i=z("p"),i.textContent=a,c=$(),s=z("div"),Y(l.$$.fragment),this.h()},l(f){e=R(f,"DIV",{class:!0});var m=B(e);r=R(m,"DIV",{class:!0});var d=B(r);K(t.$$.fragment,d),o=ee(d),i=R(d,"P",{class:!0,"data-svelte-h":!0}),Ie(i)!=="svelte-1n6fk0q"&&(i.textContent=a),d.forEach(M),c=ee(m),s=R(m,"DIV",{class:!0});var p=B(s);K(l.$$.fragment,p),p.forEach(M),m.forEach(M),this.h()},h(){T(i,"class","text-xs"),T(r,"class","flex flex-col"),oe(r,"animate-pulse",n[6]==re.STOPPED),T(s,"class","pb-1"),oe(s,"opacity-0",n[6]!=re.STOPPED),T(e,"class","flex flex-col")},m(f,m){H(f,e,m),A(e,r),X(t,r,null),A(r,o),A(r,i),A(e,c),A(e,s),X(l,s,null),u=!0},p(f,m){(!u||m&64)&&oe(r,"animate-pulse",f[6]==re.STOPPED),(!u||m&64)&&oe(s,"opacity-0",f[6]!=re.STOPPED)},i(f){u||(k(t.$$.fragment,f),k(l.$$.fragment,f),u=!0)},o(f){P(t.$$.fragment,f),P(l.$$.fragment,f),u=!1},d(f){f&&M(e),J(t),J(l)}}}function No(n){let e,r;return{c(){e=z("img"),this.h()},l(t){e=R(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){ht(e.src,r=n[4])||T(e,"src",r),T(e,"alt","Camera stream"),T(e,"class","w-[24rem] h-[16rem] absolute bottom-0 m-4 rounded-lg")},m(t,o){H(t,e,o)},p(t,o){o&16&&!ht(e.src,r=t[4])&&T(e,"src",r)},d(t){t&&M(e)}}}function Ao(n){let e,r='<span class="material-symbols-outlined text-4xl">videocam_off</span>';return{c(){e=z("div"),e.innerHTML=r,this.h()},l(t){e=R(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-zpv1b1"&&(e.innerHTML=r),this.h()},h(){T(e,"class","w-[18rem] h-[12rem] absolute bottom-0 m-4 rounded-lg flex items-center justify-center border-2")},m(t,o){H(t,e,o)},p:se,d(t){t&&M(e)}}}function zo(n){let e,r,t,o,i,a,c,s,l,u,f,m,d,p,h,x,O="Assistance Level",F,D,w,L,Z,v,C,I,N={};i=new jn({props:N}),n[12](i),s=new Rn({});let g=n[0]&&Vt(n),b=n[6]==re.TELEOP&&Se.CONNECTED&&n[7]<3&&jt(n);function y(_){n[14](_)}let j={min:0,max:3,step:1,class:"relative flex w-full touch-none select-none items-center",$$slots:{default:[Po,({thumbs:_,ticks:S})=>({22:_,23:S}),({thumbs:_,ticks:S})=>(_?4194304:0)|(S?8388608:0)]},$$scope:{ctx:n}};n[2]!==void 0&&(j.teleop_assistance_level=n[2]),D=new Yn({props:j}),Ne.push(()=>Gt(D,"teleop_assistance_level",y));const Q=[Io,Eo,wo],G=[];function pe(_,S){return _[5]!=Se.CONNECTED?0:_[7]==3?1:2}Z=pe(n),v=G[Z]=Q[Z](n);function W(_,S){return _[4]==""?Ao:No}let V=W(n),E=V(n);return{c(){e=z("meta"),r=$(),t=z("div"),o=z("div"),Y(i.$$.fragment),a=$(),c=z("div"),Y(s.$$.fragment),l=$(),u=z("div"),g&&g.c(),f=$(),m=z("div"),d=z("div"),b&&b.c(),p=$(),h=z("div"),x=z("p"),x.textContent=O,F=$(),Y(D.$$.fragment),L=$(),v.c(),C=$(),E.c(),this.h()},l(_){const S=fn("svelte-1fo5sqm",document.head);e=R(S,"META",{name:!0,content:!0}),S.forEach(M),r=ee(_),t=R(_,"DIV",{class:!0});var U=B(t);o=R(U,"DIV",{class:!0});var ae=B(o);K(i.$$.fragment,ae),ae.forEach(M),a=ee(U),c=R(U,"DIV",{class:!0});var te=B(c);K(s.$$.fragment,te),te.forEach(M),l=ee(U),u=R(U,"DIV",{id:!0,class:!0});var ne=B(u);g&&g.l(ne),ne.forEach(M),f=ee(U),m=R(U,"DIV",{class:!0});var le=B(m);d=R(le,"DIV",{id:!0,class:!0});var fe=B(d);b&&b.l(fe),p=ee(fe),h=R(fe,"DIV",{class:!0});var Ae=B(h);x=R(Ae,"P",{class:!0,"data-svelte-h":!0}),Ie(x)!=="svelte-1u4s902"&&(x.textContent=O),F=ee(Ae),K(D.$$.fragment,Ae),Ae.forEach(M),L=ee(fe),v.l(fe),fe.forEach(M),le.forEach(M),C=ee(U),E.l(U),U.forEach(M),this.h()},h(){document.title="Steward | Canopy",T(e,"name","description"),T(e,"content","Control and observe the robot"),T(o,"class","w-[50%] bg-blue-300"),T(c,"class","w-[50%]"),T(u,"id","topright"),T(u,"class","absolute top-0 right-0 p-4 flex flex-row"),T(x,"class","text-sm pb-"),T(h,"class","w-48 h-8 px-4 overflow-hidden flex flex-col justify-center"),T(d,"id","joystick-div"),T(d,"class","absolute bottom-0 right-0 flex flex-col mx-3"),oe(d,"pointer-events-none",n[5]!=Se.CONNECTED),T(m,"class","grow overflow-hidden"),T(t,"class","flex flex-row h-full w-full")},m(_,S){A(document.head,e),H(_,r,S),H(_,t,S),A(t,o),X(i,o,null),A(t,a),A(t,c),X(s,c,null),A(t,l),A(t,u),g&&g.m(u,null),A(t,f),A(t,m),A(m,d),b&&b.m(d,null),A(d,p),A(d,h),A(h,x),A(h,F),X(D,h,null),A(d,L),G[Z].m(d,null),A(t,C),E.m(t,null),I=!0},p(_,[S]){const U={};i.$set(U),_[0]?g?(g.p(_,S),S&1&&k(g,1)):(g=Vt(_),g.c(),k(g,1),g.m(u,null)):g&&(me(),P(g,1,1,()=>{g=null}),he()),_[6]==re.TELEOP&&Se.CONNECTED&&_[7]<3?b?(b.p(_,S),S&192&&k(b,1)):(b=jt(_),b.c(),k(b,1),b.m(d,p)):b&&(me(),P(b,1,1,()=>{b=null}),he());const ae={};S&1086324736&&(ae.$$scope={dirty:S,ctx:_}),!w&&S&4&&(w=!0,ae.teleop_assistance_level=_[2],Lt(()=>w=!1)),D.$set(ae);let te=Z;Z=pe(_),Z===te?G[Z].p(_,S):(me(),P(G[te],1,1,()=>{G[te]=null}),he(),v=G[Z],v?v.p(_,S):(v=G[Z]=Q[Z](_),v.c()),k(v,1),v.m(d,null)),(!I||S&32)&&oe(d,"pointer-events-none",_[5]!=Se.CONNECTED),V===(V=W(_))&&E?E.p(_,S):(E.d(1),E=V(_),E&&(E.c(),E.m(t,null)))},i(_){I||(k(i.$$.fragment,_),k(s.$$.fragment,_),k(g),k(b),k(D.$$.fragment,_),k(v),I=!0)},o(_){P(i.$$.fragment,_),P(s.$$.fragment,_),P(g),P(b),P(D.$$.fragment,_),P(v),I=!1},d(_){_&&(M(r),M(t)),M(e),n[12](null),J(i),J(s),g&&g.d(),b&&b.d(),J(D),G[Z].d(),E.d()}}}function Ro(n,e,r){let t,o,i;de(n,bn,v=>r(5,t=v)),de(n,_n,v=>r(6,o=v)),de(n,xn,v=>r(7,i=v));let a=!0;function c(){console.log(l.locations),s.clearSeedlingMarkers();for(let[v,C]of l.locations)s.addSeedlingMarker(v,C)}let s,l=new Vn(c),u=2,f=ve(),m,d=!0;f.subscribe(v=>{if(!v)return;if(Math.abs(v.x)<.01&&Math.abs(v.y)<.01){if(d)return;d=!0}else d=!1;let C=v;C.x*=-2,C.y*=.8,pt.set(C),m=v}),setInterval(()=>{m!=null&&!d&&pt.set(m)},.1);let p="";gn.subscribe(v=>{v&&r(4,p=`data:image/jpg;base64,${v}`)});function h(){s.listenForWaypoint()}function x(){window.onRequestMode(re.TELEOP)}function O(){window.onRequestMode(re.AUTO)}function F(){window.onRequestMode(re.STOPPED)}function D(){let v=localStorage.getItem("plan");console.log(v),l.loadFromString(v);let C=JSON.parse(JSON.parse(v));s.setGeometry(C.geojson)}Ke(()=>{setTimeout(D,500)});function w(v){Ne[v?"unshift":"push"](()=>{s=v,r(1,s)})}function L(v){f=v,r(3,f)}function Z(v){u=v,r(2,u)}return[a,s,u,f,p,t,o,i,h,x,O,F,w,L,Z]}class ni extends Ce{constructor(e){super(),Me(this,e,Ro,zo,_e,{})}}export{ni as component,ti as universal};
