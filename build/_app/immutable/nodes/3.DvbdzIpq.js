import{d as ln}from"../chunks/index.R8ovVqwX.js";import{R as Re,S as we,s as _e,w as ue,i as L,f as M,D as be,k as de,E as oe,F as Ve,H as Ne,I as xe,e as z,c as R,b as H,T as Ee,N as Ye,K as ye,L as De,M as ke,n as se,v as cn,r as un,B as Ie,l as S,o as lt,aa as Oe,ad as Ht,a as $,g as ee,q as fn,C as ie,h as A,ae as Lt,t as dn,d as mn,X as hn,x as mt,U as ht}from"../chunks/scheduler.DAJm3Tm7.js";import{S as Ce,i as Me,g as me,t as P,e as he,a as C,c as q,b as Y,m as K,d as X,h as Wt,j as pn,k as vn}from"../chunks/index.CY_bOgko.js";import{e as He}from"../chunks/each.5vxhIXXg.js";import"../chunks/entry.lCp_eF6O.js";import{I as Pe}from"../chunks/Icon.BdTYuhT_.js";import{d as Gt,w as ve}from"../chunks/index.BRf4yT8s.js";import{M as re,C as Te,m as pt,q as gn,u as bn,v as _n,x as xn}from"../chunks/stores.CpqAsVgL.js";import{o as yn,w as Le,m as vt,h as gt,c as bt,g as Dn,d as $e,s as et,j as kn,e as Cn,f as We,a as Mn,i as tt,k as ce,l as nt}from"../chunks/create.X5FZDoBX.js";import{B as qe}from"../chunks/button.Dz94LN11.js";import{g as Ke}from"../chunks/spread.CgU5AtxT.js";import{o as Pn,c as wn}from"../chunks/events.o_X4bomM.js";import{t as En,a as In,c as On,r as Tn,g as Sn}from"../chunks/updater.B55IDkrE.js";import{s as rt}from"../chunks/math.BpeAD72X.js";import{P as Nn,t as An,V as ct,M as zn,a as Zt,S as ge,b as Ut,W as Rn}from"../chunks/World.x0k9-BaI.js";import"../chunks/forest_generator.BejyUwkV.js";import{O as Vn}from"../chunks/OsmMap.DH1Mlz5A.js";import{a as _t}from"../chunks/index.C__vac0b.js";const jn={defaultValue:[],min:0,max:100,step:1,orientation:"horizontal",dir:"ltr",disabled:!1},{name:Ge}=Dn("slider"),Fn=n=>{const e={...jn,...n},r=En(yn(e,"value","onValueChange","defaultValue")),{min:t,max:i,step:o,orientation:a,dir:c,disabled:s}=r,l=e.value??ve(e.defaultValue),u=Pn(l,e==null?void 0:e.onValueChange),f=Le(ve(!1)),m=Le(ve(0)),d=Le(ve(null)),p=In(["root"]),h=(k,E)=>{u.update(I=>{if(!I)return[k];if(I[E]===k)return I;const N=[...I],g=N[E]>k?-1:1;function b(){N[E]=N[E+g],N[E+g]=k;const W=x();W&&(W[E+g].focus(),d.set({thumb:W[E+g],index:E+g}))}if(g===-1&&k<N[E-1])return b(),N;if(g===1&&k>N[E+1])return b(),N;const y=t.get(),j=i.get(),J=o.get();return N[E]=rt(k,y,j,J),N})},x=()=>{const k=nt(p.root);return k?Array.from(k.querySelectorAll('[data-melt-part="thumb"]')).filter(E=>tt(E)):null},O=Gt([t,i],([k,E])=>I=>(I-k)/(E-k)*100),F=Le.derived([a,c],([k,E])=>k==="horizontal"?E==="rtl"?"rl":"lr":E==="rtl"?"tb":"bt"),D=vt(Ge(),{stores:[s,a,c],returned:([k,E,I])=>({dir:I,disabled:$e(k),"data-disabled":$e(k),"data-orientation":E,style:k?void 0:`touch-action: ${E==="horizontal"?"pan-y":"pan-x"}`,"data-melt-id":p.root})}),v=vt(Ge("range"),{stores:[u,F,O],returned:([k,E,I])=>{const N=k.length>1?I(Math.min(...k)??0):0,g=100-I(Math.max(...k)??0),b={position:"absolute"};switch(E){case"lr":{b.left=`${N}%`,b.right=`${g}%`;break}case"rl":{b.right=`${N}%`,b.left=`${g}%`;break}case"bt":{b.bottom=`${N}%`,b.top=`${g}%`;break}case"tb":{b.top=`${N}%`,b.bottom=`${g}%`;break}}return{style:et(b)}}}),B=gt(Ge("thumb"),{stores:[u,O,t,i,s,a,F],returned:([k,E,I,N,g,b,y])=>Array.from({length:k.length||1},(J,W)=>{m.get()<k.length&&m.update(_=>_+1);const G=k[W],V=`${E(G)}%`,w={position:"absolute"};switch(y){case"lr":{w.left=V,w.translate="-50% 0";break}case"rl":{w.right=V,w.translate="50% 0";break}case"bt":{w.bottom=V,w.translate="0 50%";break}case"tb":{w.top=V,w.translate="0 -50%";break}}return{role:"slider","aria-valuemin":I,"aria-valuemax":N,"aria-valuenow":G,"aria-disabled":$e(g),"aria-orientation":b,"data-melt-part":"thumb","data-value":G,style:et(w),tabindex:g?-1:0}}),action:k=>({destroy:Mn(k,"keydown",I=>{if(s.get())return;const N=I.currentTarget;if(!tt(N))return;const g=x();if(!(g!=null&&g.length))return;const b=g.indexOf(N);if(m.set(b),![ce.ARROW_LEFT,ce.ARROW_RIGHT,ce.ARROW_UP,ce.ARROW_DOWN,ce.HOME,ce.END].includes(I.key))return;I.preventDefault();const y=t.get(),j=i.get(),J=o.get(),W=u.get(),pe=a.get(),G=F.get(),V=W[b];switch(I.key){case ce.HOME:{h(y,b);break}case ce.END:{h(j,b);break}case ce.ARROW_LEFT:{if(pe!=="horizontal")break;I.metaKey?h(G==="rl"?j:y,b):G==="rl"&&V<j?h(V+J,b):G==="lr"&&V>y&&h(V-J,b);break}case ce.ARROW_RIGHT:{if(pe!=="horizontal")break;I.metaKey?h(G==="rl"?y:j,b):G==="rl"&&V>y?h(V-J,b):G==="lr"&&V<j&&h(V+J,b);break}case ce.ARROW_UP:{I.metaKey?h(G==="tb"?y:j,b):G==="tb"&&V>y?h(V-J,b):G!=="tb"&&V<j&&h(V+J,b);break}case ce.ARROW_DOWN:{I.metaKey?h(G==="tb"?j:y,b):G==="tb"&&V<j?h(V+J,b):G!=="tb"&&V>y&&h(V-J,b);break}}})})}),Q=gt(Ge("tick"),{stores:[u,t,i,o,F],returned:([k,E,I,N,g])=>{const b=I-E;let y=Math.ceil(b/N);return b%N==0&&y++,Array.from({length:y},(j,J)=>{const W=`${J*(N/(I-E))*100}%`,pe=J===0,G=J===y-1,V=pe?0:G?-100:-50,w={position:"absolute"};switch(g){case"lr":{w.left=W,w.translate=`${V}% 0`;break}case"rl":{w.right=W,w.translate=`${-V}% 0`;break}case"bt":{w.bottom=W,w.translate=`0 ${-V}%`;break}case"tb":{w.top=W,w.translate=`0 ${V}%`;break}}const _=E+J*N;return{"data-bounded":(k.length===1?_<=k[0]:k[0]<=_&&_<=k[k.length-1])?!0:void 0,"data-value":_,style:et(w)}})}});return bt([D,t,i,s,a,F,o],([k,E,I,N,g,b,y])=>{if(!kn||N)return;const j=(w,_,T,Z)=>{const te=(w-T)/(Z-T)*(I-E)+E;if(te<E)h(E,_);else if(te>I)h(I,_);else{const ne=y,le=E,fe=Math.floor((te-le)/ne),Ae=le+fe*ne+ne/2,an=le+(fe+1)*ne+ne/2,dt=te>=Ae&&te<an?(fe+1)*ne+le:fe*ne+le;dt<=I&&h(dt,_)}},J=w=>{const _=x();if(!_)return;_.forEach(te=>te.blur());const T=_.map(te=>{if(g==="horizontal"){const{left:ne,right:le}=te.getBoundingClientRect();return Math.abs(w.clientX-(ne+le)/2)}else{const{top:ne,bottom:le}=te.getBoundingClientRect();return Math.abs(w.clientY-(ne+le)/2)}}),Z=_[T.indexOf(Math.min(...T))],ae=_.indexOf(Z);return{thumb:Z,index:ae}},W=w=>{if(!f.get())return;w.preventDefault(),w.stopPropagation();const _=nt(k["data-melt-id"]),T=d.get();if(!_||!T)return;T.thumb.focus();const{left:Z,right:ae,top:te,bottom:ne}=_.getBoundingClientRect();switch(b){case"lr":{j(w.clientX,T.index,Z,ae);break}case"rl":{j(w.clientX,T.index,ae,Z);break}case"bt":{j(w.clientY,T.index,ne,te);break}case"tb":{j(w.clientY,T.index,te,ne);break}}},pe=w=>{if(w.button!==0)return;const _=nt(k["data-melt-id"]),T=J(w);if(!T||!_)return;const Z=w.target;!tt(Z)||!_.contains(Z)||(w.preventDefault(),d.set(T),T.thumb.focus(),f.set(!0),W(w))},G=()=>{f.set(!1)},V=Cn(We(document,"pointerdown",pe),We(document,"pointerup",G),We(document,"pointerleave",G),We(document,"pointermove",W));return()=>{V()}}),bt([o,t,i,u],function([E,I,N,g]){const b=j=>rt(j,I,N,E)===j,y=j=>rt(j,I,N,E);g.some(j=>!b(j))&&u.update(j=>j.map(y))}),{elements:{root:D,thumbs:B,range:v,ticks:Q},states:{value:u},options:r}};function qt(){return{NAME:"slider",PARTS:["root","input","range","thumb","tick"]}}function Bn(n){const{NAME:e,PARTS:r}=qt(),t=On(e,r),i={...Fn(Tn(n)),getAttrs:t};return Re(e,i),{...i,updateOption:Sn(i.options)}}function ut(){const{NAME:n}=qt();return we(n)}const Hn=n=>({builder:n&4,ticks:n&8,thumbs:n&16}),xt=n=>({builder:n[2],ticks:n[3],thumbs:n[4]}),Ln=n=>({builder:n&4,ticks:n&8,thumbs:n&16}),yt=n=>({builder:n[2],ticks:n[3],thumbs:n[4]});function Wn(n){let e,r,t,i;const o=n[19].default,a=xe(o,n,n[18],xt);let c=[n[2],n[8]],s={};for(let l=0;l<c.length;l+=1)s=oe(s,c[l]);return{c(){e=z("span"),a&&a.c(),this.h()},l(l){e=R(l,"SPAN",{});var u=H(e);a&&a.l(u),u.forEach(M),this.h()},h(){Ee(e,s)},m(l,u){L(l,e,u),a&&a.m(e,null),n[20](e),r=!0,t||(i=Ye(n[2].action(e)),t=!0)},p(l,u){a&&a.p&&(!r||u&262172)&&ye(a,o,l,l[18],r?ke(o,l[18],u,Hn):De(l[18]),xt),Ee(e,s=Ke(c,[u&4&&l[2],u&256&&l[8]]))},i(l){r||(C(a,l),r=!0)},o(l){P(a,l),r=!1},d(l){l&&M(e),a&&a.d(l),n[20](null),t=!1,i()}}}function Gn(n){let e;const r=n[19].default,t=xe(r,n,n[18],yt);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,o){t&&t.p&&(!e||o&262172)&&ye(t,r,i,i[18],e?ke(r,i[18],o,Ln):De(i[18]),yt)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}function Zn(n){let e,r,t,i;const o=[Gn,Wn],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=o[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),L(s,t,l),i=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){i||(C(r),i=!0)},o(s){P(r),i=!1},d(s){s&&M(t),a[e].d(s)}}}function Un(n,e,r){let t;const i=["disabled","min","max","step","orientation","dir","value","onValueChange","asChild","el"];let o=be(e,i),a,c,s,{$$slots:l={},$$scope:u}=e,{disabled:f=void 0}=e,{min:m=void 0}=e,{max:d=void 0}=e,{step:p=void 0}=e,{orientation:h=void 0}=e,{dir:x=void 0}=e,{value:O=void 0}=e,{onValueChange:F=void 0}=e,{asChild:D=!1}=e,{el:v=void 0}=e;const{elements:{root:B,ticks:Q,thumbs:k},states:{value:E},updateOption:I,getAttrs:N}=Bn({disabled:f,dir:x,min:m,max:d,step:p,orientation:h,defaultValue:O,onValueChange:({next:y})=>(O!==y&&(F==null||F(y),r(9,O=y)),y)});de(n,B,y=>r(17,a=y)),de(n,Q,y=>r(3,c=y)),de(n,k,y=>r(4,s=y));const g=N("root");function b(y){Ne[y?"unshift":"push"](()=>{v=y,r(0,v)})}return n.$$set=y=>{e=oe(oe({},e),Ve(y)),r(8,o=be(e,i)),"disabled"in y&&r(10,f=y.disabled),"min"in y&&r(11,m=y.min),"max"in y&&r(12,d=y.max),"step"in y&&r(13,p=y.step),"orientation"in y&&r(14,h=y.orientation),"dir"in y&&r(15,x=y.dir),"value"in y&&r(9,O=y.value),"onValueChange"in y&&r(16,F=y.onValueChange),"asChild"in y&&r(1,D=y.asChild),"el"in y&&r(0,v=y.el),"$$scope"in y&&r(18,u=y.$$scope)},n.$$.update=()=>{n.$$.dirty&512&&O!==void 0&&E.set(O),n.$$.dirty&1024&&I("disabled",f),n.$$.dirty&2048&&I("min",m),n.$$.dirty&4096&&I("max",d),n.$$.dirty&8192&&I("step",p),n.$$.dirty&16384&&I("orientation",h),n.$$.dirty&32768&&I("dir",x),n.$$.dirty&131072&&r(2,t=a),n.$$.dirty&4&&Object.assign(t,g)},[v,D,t,c,s,B,Q,k,o,O,f,m,d,p,h,x,F,a,u,l,b]}class qn extends Ce{constructor(e){super(),Me(this,e,Un,Zn,_e,{disabled:10,min:11,max:12,step:13,orientation:14,dir:15,value:9,onValueChange:16,asChild:1,el:0})}}const Yn=n=>({builder:n&4}),Dt=n=>({builder:n[2]});function Kn(n){let e,r,t,i=[n[2],n[4]],o={};for(let a=0;a<i.length;a+=1)o=oe(o,i[a]);return{c(){e=z("span"),this.h()},l(a){e=R(a,"SPAN",{}),H(e).forEach(M),this.h()},h(){Ee(e,o)},m(a,c){L(a,e,c),n[8](e),r||(t=Ye(n[2].action(e)),r=!0)},p(a,c){Ee(e,o=Ke(i,[c&4&&a[2],c&16&&a[4]]))},i:se,o:se,d(a){a&&M(e),n[8](null),r=!1,t()}}}function Xn(n){let e;const r=n[7].default,t=xe(r,n,n[6],Dt);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,o){t&&t.p&&(!e||o&68)&&ye(t,r,i,i[6],e?ke(r,i[6],o,Yn):De(i[6]),Dt)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}function Jn(n){let e,r,t,i;const o=[Xn,Kn],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=o[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),L(s,t,l),i=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){i||(C(r),i=!0)},o(s){P(r),i=!1},d(s){s&&M(t),a[e].d(s)}}}function Qn(n,e,r){let t;const i=["asChild","el"];let o=be(e,i),a,{$$slots:c={},$$scope:s}=e,{asChild:l=!1}=e,{el:u=void 0}=e;const{elements:{range:f},getAttrs:m}=ut();de(n,f,h=>r(5,a=h));const d=m("range");function p(h){Ne[h?"unshift":"push"](()=>{u=h,r(0,u)})}return n.$$set=h=>{e=oe(oe({},e),Ve(h)),r(4,o=be(e,i)),"asChild"in h&&r(1,l=h.asChild),"el"in h&&r(0,u=h.el),"$$scope"in h&&r(6,s=h.$$scope)},n.$$.update=()=>{n.$$.dirty&32&&r(2,t=a),n.$$.dirty&4&&Object.assign(t,d)},[u,l,t,f,o,a,s,c,p]}class $n extends Ce{constructor(e){super(),Me(this,e,Qn,Jn,_e,{asChild:1,el:0})}}const er=n=>({builder:n&4}),kt=n=>({builder:n[2]});function tr(n){let e,r,t,i=[n[2],n[4]],o={};for(let a=0;a<i.length;a+=1)o=oe(o,i[a]);return{c(){e=z("span"),this.h()},l(a){e=R(a,"SPAN",{}),H(e).forEach(M),this.h()},h(){Ee(e,o)},m(a,c){L(a,e,c),n[8](e),r||(t=[Ye(n[2].action(e)),cn(e,"m-keydown",n[3])],r=!0)},p(a,c){Ee(e,o=Ke(i,[c&4&&a[2],c&16&&a[4]]))},i:se,o:se,d(a){a&&M(e),n[8](null),r=!1,un(t)}}}function nr(n){let e;const r=n[7].default,t=xe(r,n,n[6],kt);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,o){t&&t.p&&(!e||o&68)&&ye(t,r,i,i[6],e?ke(r,i[6],o,er):De(i[6]),kt)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}function rr(n){let e,r,t,i;const o=[nr,tr],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=o[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),L(s,t,l),i=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){i||(C(r),i=!0)},o(s){P(r),i=!1},d(s){s&&M(t),a[e].d(s)}}}function ir(n,e,r){let t;const i=["asChild","el","thumb"];let o=be(e,i),{$$slots:a={},$$scope:c}=e,{asChild:s=!1}=e,{el:l=void 0}=e,{thumb:u}=e;const{getAttrs:f}=ut(),m=wn(),d=f("thumb");function p(h){Ne[h?"unshift":"push"](()=>{l=h,r(0,l)})}return n.$$set=h=>{e=oe(oe({},e),Ve(h)),r(4,o=be(e,i)),"asChild"in h&&r(1,s=h.asChild),"el"in h&&r(0,l=h.el),"thumb"in h&&r(5,u=h.thumb),"$$scope"in h&&r(6,c=h.$$scope)},n.$$.update=()=>{n.$$.dirty&32&&r(2,t=u),n.$$.dirty&4&&Object.assign(t,d)},[l,s,t,m,o,u,c,a,p]}class or extends Ce{constructor(e){super(),Me(this,e,ir,rr,_e,{asChild:1,el:0,thumb:5})}}const sr=n=>({builder:n&4}),Ct=n=>({builder:n[2]});function ar(n){let e,r,t,i=[n[2],n[3]],o={};for(let a=0;a<i.length;a+=1)o=oe(o,i[a]);return{c(){e=z("span"),this.h()},l(a){e=R(a,"SPAN",{}),H(e).forEach(M),this.h()},h(){Ee(e,o)},m(a,c){L(a,e,c),n[7](e),r||(t=Ye(n[2].action(e)),r=!0)},p(a,c){Ee(e,o=Ke(i,[c&4&&a[2],c&8&&a[3]]))},i:se,o:se,d(a){a&&M(e),n[7](null),r=!1,t()}}}function lr(n){let e;const r=n[6].default,t=xe(r,n,n[5],Ct);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,o){t&&t.p&&(!e||o&36)&&ye(t,r,i,i[5],e?ke(r,i[5],o,sr):De(i[5]),Ct)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}function cr(n){let e,r,t,i;const o=[lr,ar],a=[];function c(s,l){return s[1]?0:1}return e=c(n),r=a[e]=o[e](n),{c(){r.c(),t=ue()},l(s){r.l(s),t=ue()},m(s,l){a[e].m(s,l),L(s,t,l),i=!0},p(s,[l]){let u=e;e=c(s),e===u?a[e].p(s,l):(me(),P(a[u],1,1,()=>{a[u]=null}),he(),r=a[e],r?r.p(s,l):(r=a[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){i||(C(r),i=!0)},o(s){P(r),i=!1},d(s){s&&M(t),a[e].d(s)}}}function ur(n,e,r){let t;const i=["asChild","el","tick"];let o=be(e,i),{$$slots:a={},$$scope:c}=e,{asChild:s=!1}=e,{el:l=void 0}=e,{tick:u}=e;const{getAttrs:f}=ut(),m=f("tick");function d(p){Ne[p?"unshift":"push"](()=>{l=p,r(0,l)})}return n.$$set=p=>{e=oe(oe({},e),Ve(p)),r(3,o=be(e,i)),"asChild"in p&&r(1,s=p.asChild),"el"in p&&r(0,l=p.el),"tick"in p&&r(4,u=p.tick),"$$scope"in p&&r(5,c=p.$$scope)},n.$$.update=()=>{n.$$.dirty&16&&r(2,t=u),n.$$.dirty&4&&Object.assign(t,m)},[l,s,t,o,u,c,a,d]}class fr extends Ce{constructor(e){super(),Me(this,e,ur,cr,_e,{asChild:1,el:0,tick:4})}}const dr=ln,mr=!0,$i=Object.freeze(Object.defineProperty({__proto__:null,csr:dr,prerender:mr},Symbol.toStringTag,{value:"Module"}));function hr(n){let e,r='<img src="res/joystick-base.png" class="mx-auto pt-8"/> <div id="stick" class="relative overflow-hidden left-[4rem] top-[-6rem]"><div class="w-16 h-16 rounded-[2rem] bg-neutral-700 shadow-2xl overflow-hidden"></div></div>';return{c(){e=z("div"),e.innerHTML=r,this.h()},l(t){e=R(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-19l2o9x"&&(e.innerHTML=r),this.h()},h(){S(e,"class","w-48 h-48 overflow-hidden")},m(t,i){L(t,e,i)},p:se,i:se,o:se,d(t){t&&M(e)}}}function pr(n,e,r){let t,i,o,a=!1,{maxDistance:c=64}=e,{deadzone:s=8}=e,{value:l=ve({x:0,y:0})}=e;function u(d){t!=null&&(a=!0,t.style.transition="0s",d.preventDefault(),d instanceof TouchEvent?(i={x:d.changedTouches[0].clientX,y:d.changedTouches[0].clientY},o=d.changedTouches[0].identifier):i={x:d.clientX,y:d.clientY})}function f(d){if(!a||t==null)return;let p=0,h=0,x=null;if(d instanceof TouchEvent){for(let b=0;b<d.changedTouches.length;b++)o==d.changedTouches[b].identifier&&(x=b,p=d.changedTouches[b].clientX,h=d.changedTouches[b].clientY);if(x==null)return}else p=d.clientX,h=d.clientY;const O=p-i.x,F=h-i.y,D=Math.atan2(F,O),v=Math.min(c,Math.hypot(O,F)),B=v*Math.cos(D),Q=v*Math.sin(D);t.style.transform=`translate3d(${B}px, ${Q}px, 0px)`;const k=v<s?0:c/(c-s)*(v-s),E=k*Math.cos(D),I=k*Math.sin(D),N=parseFloat((E/c).toFixed(4)),g=parseFloat((I/c).toFixed(4));l.set({x:N,y:g})}function m(d){!a||t==null||d instanceof TouchEvent&&o!=d.changedTouches[0].identifier||(t.style.transition=".2s",t.style.transform="translate3d(0px, 0px, 0px)",l.set({x:0,y:0}),o=null,a=!1)}return lt(()=>{t=document.getElementById("stick"),t.addEventListener("mousedown",u),t.addEventListener("touchstart",u),document.addEventListener("mousemove",f,{passive:!1}),document.addEventListener("touchmove",f,{passive:!1}),document.addEventListener("mouseup",m),document.addEventListener("touchend",m)}),n.$$set=d=>{"maxDistance"in d&&r(0,c=d.maxDistance),"deadzone"in d&&r(1,s=d.deadzone),"value"in d&&r(2,l=d.value)},[c,s,l]}class vr extends Ce{constructor(e){super(),Me(this,e,pr,hr,_e,{maxDistance:0,deadzone:1,value:2})}}const gr=(n,e)=>{const r=Gt(n,o=>o);let t;const i=r.subscribe(async o=>{t&&t();const a=await e(o);a&&(t=a)});Oe(()=>{i(),t&&t()})},Yt=new Nn(75,0,.1,1e3);Yt.position.z=5;Yt.lookAt(0,0,0);function Kt(n,e){const r=ve(n);let t=n;const i=r.subscribe(c=>t=c);return Oe(i),{...r,set:c=>{if((c==null?void 0:c.uuid)===(t==null?void 0:t.uuid))return;const s=t;r.set(c),e==null||e(c,s)},update:c=>{const s=c(t);if((s==null?void 0:s.uuid)===(t==null?void 0:t.uuid))return;const l=t;r.set(s),e==null||e(s,l)}}}const Xe=()=>{const n=we("threlte");if(n===void 0)throw new Error("No Threlte context found, are you using this hook inside of <Canvas>?");return n},ft=Symbol("threlte-hierarchical-parent-context"),Xt=()=>we(ft),br=n=>Re(ft,n),_r=n=>{const e=Kt(n);return Re(ft,e),e};function xr(n){let e;const r=n[7].default,t=xe(r,n,n[6],null);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,[o]){t&&t.p&&(!e||o&64)&&ye(t,r,i,i[6],e?ke(r,i[6],o,null):De(i[6]),null)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}const yr=()=>({onChildMount:we("threlte-hierarchical-object-on-mount"),onChildDestroy:we("threlte-hierarchical-object-on-destroy")});function Dr(n,e,r){var x;let t,{$$slots:i={},$$scope:o}=e,{object:a=void 0}=e,{onChildMount:c=void 0}=e;const s=O=>{c==null||c(O)};let{onChildDestroy:l=void 0}=e;const u=O=>{l==null||l(O)},{invalidate:f}=Xe(),m=Xt();de(n,m,O=>r(5,t=O));let{parent:d=t}=e;const p=yr();a&&((x=p.onChildMount)==null||x.call(p,a),f());const h=Kt(a,(O,F)=>{var D,v;F&&((D=p.onChildDestroy)==null||D.call(p,F),f()),O&&((v=p.onChildMount)==null||v.call(p,O),f())});return Oe(()=>{var O;a&&((O=p.onChildDestroy)==null||O.call(p,a),f())}),Re("threlte-hierarchical-object-on-mount",s),Re("threlte-hierarchical-object-on-destroy",u),br(h),n.$$set=O=>{"object"in O&&r(2,a=O.object),"onChildMount"in O&&r(3,c=O.onChildMount),"onChildDestroy"in O&&r(4,l=O.onChildDestroy),"parent"in O&&r(1,d=O.parent),"$$scope"in O&&r(6,o=O.$$scope)},n.$$.update=()=>{n.$$.dirty&32&&r(1,d=t),n.$$.dirty&4&&h.set(a)},[m,d,a,c,l,t,o,i]}class kr extends Ce{constructor(e){super(),Me(this,e,Dr,xr,_e,{object:2,onChildMount:3,onChildDestroy:4,parent:1})}}function Cr(n){let e;const r=n[1].default,t=xe(r,n,n[4],null);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,o){t&&t.p&&(!e||o&16)&&ye(t,r,i,i[4],e?ke(r,i[4],o,null):De(i[4]),null)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}function Mr(n){let e,r;return e=new kr({props:{object:n[0],onChildMount:n[2],onChildDestroy:n[3],$$slots:{default:[Cr]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,i){K(e,t,i),r=!0},p(t,[i]){const o={};i&1&&(o.object=t[0]),i&1&&(o.onChildMount=t[2]),i&1&&(o.onChildDestroy=t[3]),i&16&&(o.$$scope={dirty:i,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function Pr(n,e,r){let{$$slots:t={},$$scope:i}=e,{object:o}=e;const a=s=>o.add(s),c=s=>o.remove(s);return n.$$set=s=>{"object"in s&&r(0,o=s.object),"$$scope"in s&&r(4,i=s.$$scope)},[o,t,a,c,i]}class wr extends Ce{constructor(e){super(),Me(this,e,Pr,Mr,_e,{object:0})}}const Er=()=>we("threlte-internal-context");function Ir(n){let e;const r=n[9].default,t=xe(r,n,n[8],null);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,[o]){t&&t.p&&(!e||o&256)&&ye(t,r,i,i[8],e?ke(r,i[8],o,null):De(i[8]),null)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}const Mt="threlte-disposable-object-context";function Or(n,e,r){let t,i,{$$slots:o={},$$scope:a}=e;const{collectDisposableObjects:c,addDisposableObjects:s,removeDisposableObjects:l}=Er();let{object:u=void 0}=e,f=u,{dispose:m=void 0}=e;const d=we(Mt);de(n,d,x=>r(7,i=x));const p=ve(m??i??!0);de(n,p,x=>r(6,t=x)),Re(Mt,p);let h=t?c(u):[];return s(h),Oe(()=>{l(h)}),n.$$set=x=>{"object"in x&&r(2,u=x.object),"dispose"in x&&r(3,m=x.dispose),"$$scope"in x&&r(8,a=x.$$scope)},n.$$.update=()=>{n.$$.dirty&136&&p.set(m??i??!0),n.$$.dirty&116&&u!==f&&(l(h),r(5,h=t?c(u):[]),s(h),r(4,f=u))},[d,p,u,m,f,h,t,i,a,o]}class Tr extends Ce{constructor(e){super(),Me(this,e,Or,Ir,_e,{object:2,dispose:3})}}const Sr=/^\s*class\s+/,Nr=n=>typeof n!="function"?!1:Sr.test(n.toString()),Ar=n=>Array.isArray(n),Pt=(n,e)=>Nr(n)?Ar(e)?new n(...e):new n:n,zr=n=>"isObject3D"in n,wt=n=>"dispose"in n,Jt=(n,e)=>{if(e.includes(".")){const r=e.split("."),t=r.pop();for(let i=0;i<r.length;i+=1)n=n[r[i]];return{target:n,key:t}}else return{target:n,key:e}},it=Symbol("initialValueBeforeAttach"),Rr=()=>{const{invalidate:n}=Xe();let e=!1,r=it,t,i,o;const a=(s,l,u)=>{if(c(),!u){const f=s;((f==null?void 0:f.isMaterial)||!1)&&(u="material"),((f==null?void 0:f.isBufferGeometry)||(f==null?void 0:f.isGeometry)||!1)&&(u="geometry")}if(u){if(typeof u=="function")t=u(l,s);else{const{target:f,key:m}=Jt(l,u);r=f[m],f[m]=s,i=f,o=m}e=!0,n()}},c=()=>{e&&(t?(t(),t=void 0):i&&o&&r!==it&&(i[o]=r,r=it,i=void 0,o=void 0),e=!1,n())};return Oe(()=>{c()}),{update:a}},Vr=n=>n&&n.isCamera,Qt=n=>n&&n.isOrthographicCamera,$t=n=>n&&n.isPerspectiveCamera,jr=n=>$t(n)||Qt(n),Fr=()=>{const{invalidate:n,size:e,camera:r}=Xe();let t,i;Oe(()=>{i==null||i()});const o=s=>{t&&(Qt(t)?(t.left=s.width/-2,t.right=s.width/2,t.top=s.height/2,t.bottom=s.height/-2,t.updateProjectionMatrix(),t.updateMatrixWorld(),n()):$t(t)&&(t.aspect=s.width/s.height,t.updateProjectionMatrix(),t.updateMatrixWorld(),n()))};return{update:(s,l)=>{if(i==null||i(),l||!jr(s)){t=void 0;return}t=s,i=e.subscribe(o)},makeDefaultCamera:(s,l)=>{!Vr(s)||!l||(r.set(s),n())}}},en=()=>{const n=Ht(),e=(t,i)=>{const o=n.$$.callbacks[t];o&&o.forEach(a=>{a(i)})};return Object.defineProperty(e,"hasEventListener",{value:t=>!!n.$$.callbacks[t],enumerable:!0}),e},Br=()=>{const n=en(),e=[];let r,t=!1;const i=()=>{e.forEach(c=>c()),e.length=0,n("create",{ref:r,cleanup:c=>{e.push(c)}})},o=a=>{r=a,t&&i()};return lt(()=>{i(),t=!0}),Oe(()=>{e.forEach(a=>a())}),{updateRef:o}},Et=n=>!!(n!=null&&n.addEventListener),Hr=()=>{const n=en(),e=Ht(),r=s=>{s!=null&&s.type&&n(s.type,s)},t=(s,l)=>{Et(s)&&l.forEach(u=>{s.removeEventListener(u,r)})},i=(s,l)=>{Et(s)&&l.forEach(u=>{s.addEventListener(u,r)})},o=ve(),a=ve([]);return gr([o,a],([s,l])=>(i(s,l),()=>t(s,l))),lt(()=>{a.set(Object.keys(e.$$.callbacks))}),{updateRef:s=>{o.set(s)}}},Lr=n=>{const r=we("threlte-plugin-context");if(!r)return;const t=Object.values(r).map(l=>l(n)).filter(Boolean),i=t.flatMap(l=>l.pluginProps??[]);let o=[];return Oe(()=>{o.forEach(l=>l())}),{updateRef:l=>{o.forEach(u=>u()),o=[],t.forEach(u=>{var m;const f=(m=u.onRefChange)==null?void 0:m.call(u,l);f&&o.push(f)})},updateProps:l=>{t.forEach(u=>{var f;(f=u.onPropsChange)==null||f.call(u,l)})},updateRestProps:l=>{t.forEach(u=>{var f;(f=u.onRestPropsChange)==null||f.call(u,l)})},pluginsProps:i}},Wr=new Set(["$$scope","$$slots","type","args","attach","instance"]),Gr=new Set(["fov","aspect","near","far","left","right","top","bottom","zoom"]),Zr=n=>typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n>"u"||n===null,It=(n,e,r)=>{var t,i,o;return!Array.isArray(r)&&typeof r=="number"&&typeof((t=n[e])==null?void 0:t.setScalar)=="function"&&!((i=n[e])!=null&&i.isColor)?(a,c,s)=>{a[c].setScalar(s)}:typeof((o=n[e])==null?void 0:o.set)=="function"?Array.isArray(r)?(a,c,s)=>{a[c].set(...s)}:(a,c,s)=>{a[c].set(s)}:(a,c,s)=>{a[c]=s}},Ur=()=>{const{invalidate:n}=Xe(),e=new Map,r=new Map,t=(o,a,c,s)=>{if(Zr(c)){const f=e.get(a);if(f&&f.instance===o&&f.value===c)return;e.set(a,{instance:o,value:c})}const{key:l,target:u}=Jt(o,a);if(c!=null){const f=r.get(a);if(f)f(u,l,c);else{const m=It(u,l,c);r.set(a,m),m(u,l,c)}}else It(u,l,c)(u,l,c);s.manualCamera||Gr.has(l)&&(u.isPerspectiveCamera||u.isOrthographicCamera)&&u.updateProjectionMatrix()};return{updateProps:(o,a,c)=>{var s;for(const l in a)!Wr.has(l)&&!((s=c.pluginsProps)!=null&&s.includes(l))&&t(o,l,a[l],c),n()}}},qr=n=>({ref:n&2}),Ot=n=>({ref:n[1]}),Yr=n=>({ref:n&2}),Tt=n=>({ref:n[1]});function St(n){let e,r;return e=new Tr({props:{object:n[1],dispose:n[0]}}),{c(){q(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,i){K(e,t,i),r=!0},p(t,i){const o={};i&2&&(o.object=t[1]),i&1&&(o.dispose=t[0]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function Kr(n){let e;const r=n[10].default,t=xe(r,n,n[11],Ot);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,o){t&&t.p&&(!e||o&2050)&&ye(t,r,i,i[11],e?ke(r,i[11],o,qr):De(i[11]),Ot)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}function Xr(n){let e,r;return e=new wr({props:{object:n[1],$$slots:{default:[Jr]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,i){K(e,t,i),r=!0},p(t,i){const o={};i&2&&(o.object=t[1]),i&2050&&(o.$$scope={dirty:i,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function Jr(n){let e;const r=n[10].default,t=xe(r,n,n[11],Tt);return{c(){t&&t.c()},l(i){t&&t.l(i)},m(i,o){t&&t.m(i,o),e=!0},p(i,o){t&&t.p&&(!e||o&2050)&&ye(t,r,i,i[11],e?ke(r,i[11],o,Yr):De(i[11]),Tt)},i(i){e||(C(t,i),e=!0)},o(i){P(t,i),e=!1},d(i){t&&t.d(i)}}}function Qr(n){let e=wt(n[1]),r,t,i,o,a,c,s=e&&St(n);const l=[Xr,Kr],u=[];function f(m,d){return d&2&&(t=null),t==null&&(t=!!zr(m[1])),t?0:1}return i=f(n,-1),o=u[i]=l[i](n),{c(){s&&s.c(),r=$(),o.c(),a=ue()},l(m){s&&s.l(m),r=ee(m),o.l(m),a=ue()},m(m,d){s&&s.m(m,d),L(m,r,d),u[i].m(m,d),L(m,a,d),c=!0},p(m,[d]){d&2&&(e=wt(m[1])),e?s?(s.p(m,d),d&2&&C(s,1)):(s=St(m),s.c(),C(s,1),s.m(r.parentNode,r)):s&&(me(),P(s,1,1,()=>{s=null}),he());let p=i;i=f(m,d),i===p?u[i].p(m,d):(me(),P(u[p],1,1,()=>{u[p]=null}),he(),o=u[i],o?o.p(m,d):(o=u[i]=l[i](m),o.c()),C(o,1),o.m(a.parentNode,a))},i(m){c||(C(s),C(o),c=!0)},o(m){P(s),P(o),c=!1},d(m){m&&(M(r),M(a)),s&&s.d(m),u[i].d(m)}}}function $r(n,e,r){const t=["is","args","attach","manual","makeDefault","dispose","ref"];let i=be(e,t),o,{$$slots:a={},$$scope:c}=e,{is:s}=e,{args:l=void 0}=e,{attach:u=void 0}=e,{manual:f=void 0}=e,{makeDefault:m=void 0}=e,{dispose:d=void 0}=e;const p=Xt();de(n,p,g=>r(9,o=g));const h=Br();let x=Pt(s,l);h.updateRef(x);let O=!1;const F=()=>{if(!O){O=!0;return}r(1,x=Pt(s,l)),h.updateRef(x)};let{ref:D=x}=e;const v=_r(x),B=Lr({ref:x,props:e}),Q=(B==null?void 0:B.pluginsProps)??[],k=Ur(),E=Fr(),I=Rr(),N=Hr();return n.$$set=g=>{r(23,e=oe(oe({},e),Ve(g))),r(22,i=be(e,t)),"is"in g&&r(4,s=g.is),"args"in g&&r(5,l=g.args),"attach"in g&&r(6,u=g.attach),"manual"in g&&r(7,f=g.manual),"makeDefault"in g&&r(8,m=g.makeDefault),"dispose"in g&&r(0,d=g.dispose),"ref"in g&&r(3,D=g.ref),"$$scope"in g&&r(11,c=g.$$scope)},n.$$.update=()=>{n.$$.dirty&48&&F(),n.$$.dirty&2&&r(3,D=x),n.$$.dirty&2&&v.set(x),k.updateProps(x,i,{manualCamera:f,pluginsProps:Q}),n.$$.dirty&130&&E.update(x,f),n.$$.dirty&258&&E.makeDefaultCamera(x,m),n.$$.dirty&578&&I.update(x,o,u),n.$$.dirty&2&&N.updateRef(x),n.$$.dirty&2&&(B==null||B.updateRef(x)),B==null||B.updateProps(e),B==null||B.updateRestProps(i)},e=Ve(e),[d,x,p,D,s,l,u,f,m,o,a,c]}class tn extends Ce{constructor(e){super(),Me(this,e,$r,Qr,_e,{is:4,args:5,attach:6,manual:7,makeDefault:8,dispose:0,ref:3})}}const ei={},ti=(n,e)=>{const r=ei[e]||An[e];if(!r)throw new Error(`No Three.js module found for ${e}. Did you forget to extend the catalogue?`);return{...n,props:{...n.props,is:r}}},ni=n=>new Proxy(class{},{construct(e,[r]){const t=r;return new tn(ti(t,n))}});new Proxy(class{},{construct(n,[e]){const r=e;return new tn(r)},get(n,e){return ni(e)}});new ct;new ct;new ct;new Zt;new Zt;new zn;`${ge.logdepthbuf_pars_vertex}${ge.fog_pars_vertex}${ge.logdepthbuf_vertex}${ge.fog_vertex}`;`${ge.tonemapping_fragment}${ge.colorspace_fragment}`;`${ge.tonemapping_fragment}${ge.colorspace_fragment}`;const ri=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,ii=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,oi=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,si=oi,ai=`
	${ri}
	${ii}
`;`${si}${ai}${ge.tonemapping_fragment}${ge.colorspace_fragment}`;for(let n=0;n<256;n++)(n<16?"0":"")+n.toString(16);var nn={exports:{}};nn.exports=Je;nn.exports.default=Je;function Je(n,e,r){r=r||2;var t=e&&e.length,i=t?e[0]*r:n.length,o=rn(n,0,i,r,!0),a=[];if(!o||o.next===o.prev)return a;var c,s,l,u,f,m,d;if(t&&(o=di(n,e,o,r)),n.length>80*r){c=l=n[0],s=u=n[1];for(var p=r;p<i;p+=r)f=n[p],m=n[p+1],f<c&&(c=f),m<s&&(s=m),f>l&&(l=f),m>u&&(u=m);d=Math.max(l-c,u-s),d=d!==0?32767/d:0}return je(o,a,r,c,s,d,0),a}function rn(n,e,r,t,i){var o,a;if(i===at(n,e,r,t)>0)for(o=e;o<r;o+=t)a=Nt(o,n[o],n[o+1],a);else for(o=r-t;o>=e;o-=t)a=Nt(o,n[o],n[o+1],a);return a&&Qe(a,a.next)&&(Be(a),a=a.next),a}function Se(n,e){if(!n)return n;e||(e=n);var r=n,t;do if(t=!1,!r.steiner&&(Qe(r,r.next)||U(r.prev,r,r.next)===0)){if(Be(r),r=e=r.prev,r===r.next)break;t=!0}else r=r.next;while(t||r!==e);return e}function je(n,e,r,t,i,o,a){if(n){!a&&o&&gi(n,t,i,o);for(var c=n,s,l;n.prev!==n.next;){if(s=n.prev,l=n.next,o?ci(n,t,i,o):li(n)){e.push(s.i/r|0),e.push(n.i/r|0),e.push(l.i/r|0),Be(n),n=l.next,c=l.next;continue}if(n=l,n===c){a?a===1?(n=ui(Se(n),e,r),je(n,e,r,t,i,o,2)):a===2&&fi(n,e,r,t,i,o):je(Se(n),e,r,t,i,o,1);break}}}}function li(n){var e=n.prev,r=n,t=n.next;if(U(e,r,t)>=0)return!1;for(var i=e.x,o=r.x,a=t.x,c=e.y,s=r.y,l=t.y,u=i<o?i<a?i:a:o<a?o:a,f=c<s?c<l?c:l:s<l?s:l,m=i>o?i>a?i:a:o>a?o:a,d=c>s?c>l?c:l:s>l?s:l,p=t.next;p!==e;){if(p.x>=u&&p.x<=m&&p.y>=f&&p.y<=d&&ze(i,c,o,s,a,l,p.x,p.y)&&U(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ci(n,e,r,t){var i=n.prev,o=n,a=n.next;if(U(i,o,a)>=0)return!1;for(var c=i.x,s=o.x,l=a.x,u=i.y,f=o.y,m=a.y,d=c<s?c<l?c:l:s<l?s:l,p=u<f?u<m?u:m:f<m?f:m,h=c>s?c>l?c:l:s>l?s:l,x=u>f?u>m?u:m:f>m?f:m,O=ot(d,p,e,r,t),F=ot(h,x,e,r,t),D=n.prevZ,v=n.nextZ;D&&D.z>=O&&v&&v.z<=F;){if(D.x>=d&&D.x<=h&&D.y>=p&&D.y<=x&&D!==i&&D!==a&&ze(c,u,s,f,l,m,D.x,D.y)&&U(D.prev,D,D.next)>=0||(D=D.prevZ,v.x>=d&&v.x<=h&&v.y>=p&&v.y<=x&&v!==i&&v!==a&&ze(c,u,s,f,l,m,v.x,v.y)&&U(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;D&&D.z>=O;){if(D.x>=d&&D.x<=h&&D.y>=p&&D.y<=x&&D!==i&&D!==a&&ze(c,u,s,f,l,m,D.x,D.y)&&U(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;v&&v.z<=F;){if(v.x>=d&&v.x<=h&&v.y>=p&&v.y<=x&&v!==i&&v!==a&&ze(c,u,s,f,l,m,v.x,v.y)&&U(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function ui(n,e,r){var t=n;do{var i=t.prev,o=t.next.next;!Qe(i,o)&&on(i,t,t.next,o)&&Fe(i,o)&&Fe(o,i)&&(e.push(i.i/r|0),e.push(t.i/r|0),e.push(o.i/r|0),Be(t),Be(t.next),t=n=o),t=t.next}while(t!==n);return Se(t)}function fi(n,e,r,t,i,o){var a=n;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&xi(a,c)){var s=sn(a,c);a=Se(a,a.next),s=Se(s,s.next),je(a,e,r,t,i,o,0),je(s,e,r,t,i,o,0);return}c=c.next}a=a.next}while(a!==n)}function di(n,e,r,t){var i=[],o,a,c,s,l;for(o=0,a=e.length;o<a;o++)c=e[o]*t,s=o<a-1?e[o+1]*t:n.length,l=rn(n,c,s,t,!1),l===l.next&&(l.steiner=!0),i.push(_i(l));for(i.sort(mi),o=0;o<i.length;o++)r=hi(i[o],r);return r}function mi(n,e){return n.x-e.x}function hi(n,e){var r=pi(n,e);if(!r)return e;var t=sn(r,n);return Se(t,t.next),Se(r,r.next)}function pi(n,e){var r=e,t=n.x,i=n.y,o=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var c=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(c<=t&&c>o&&(o=c,a=r.x<r.next.x?r:r.next,c===t))return a}r=r.next}while(r!==e);if(!a)return null;var s=a,l=a.x,u=a.y,f=1/0,m;r=a;do t>=r.x&&r.x>=l&&t!==r.x&&ze(i<u?t:o,i,l,u,i<u?o:t,i,r.x,r.y)&&(m=Math.abs(i-r.y)/(t-r.x),Fe(r,n)&&(m<f||m===f&&(r.x>a.x||r.x===a.x&&vi(a,r)))&&(a=r,f=m)),r=r.next;while(r!==s);return a}function vi(n,e){return U(n.prev,n,e.prev)<0&&U(e.next,n,n.next)<0}function gi(n,e,r,t){var i=n;do i.z===0&&(i.z=ot(i.x,i.y,e,r,t)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,bi(i)}function bi(n){var e,r,t,i,o,a,c,s,l=1;do{for(r=n,n=null,o=null,a=0;r;){for(a++,t=r,c=0,e=0;e<l&&(c++,t=t.nextZ,!!t);e++);for(s=l;c>0||s>0&&t;)c!==0&&(s===0||!t||r.z<=t.z)?(i=r,r=r.nextZ,c--):(i=t,t=t.nextZ,s--),o?o.nextZ=i:n=i,i.prevZ=o,o=i;r=t}o.nextZ=null,l*=2}while(a>1);return n}function ot(n,e,r,t,i){return n=(n-r)*i|0,e=(e-t)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function _i(n){var e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function ze(n,e,r,t,i,o,a,c){return(i-a)*(e-c)>=(n-a)*(o-c)&&(n-a)*(t-c)>=(r-a)*(e-c)&&(r-a)*(o-c)>=(i-a)*(t-c)}function xi(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!yi(n,e)&&(Fe(n,e)&&Fe(e,n)&&Di(n,e)&&(U(n.prev,n,e.prev)||U(n,e.prev,e))||Qe(n,e)&&U(n.prev,n,n.next)>0&&U(e.prev,e,e.next)>0)}function U(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Qe(n,e){return n.x===e.x&&n.y===e.y}function on(n,e,r,t){var i=Ue(U(n,e,r)),o=Ue(U(n,e,t)),a=Ue(U(r,t,n)),c=Ue(U(r,t,e));return!!(i!==o&&a!==c||i===0&&Ze(n,r,e)||o===0&&Ze(n,t,e)||a===0&&Ze(r,n,t)||c===0&&Ze(r,e,t))}function Ze(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Ue(n){return n>0?1:n<0?-1:0}function yi(n,e){var r=n;do{if(r.i!==n.i&&r.next.i!==n.i&&r.i!==e.i&&r.next.i!==e.i&&on(r,r.next,n,e))return!0;r=r.next}while(r!==n);return!1}function Fe(n,e){return U(n.prev,n,n.next)<0?U(n,e,n.next)>=0&&U(n,n.prev,e)>=0:U(n,e,n.prev)<0||U(n,n.next,e)<0}function Di(n,e){var r=n,t=!1,i=(n.x+e.x)/2,o=(n.y+e.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(t=!t),r=r.next;while(r!==n);return t}function sn(n,e){var r=new st(n.i,n.x,n.y),t=new st(e.i,e.x,e.y),i=n.next,o=e.prev;return n.next=e,e.prev=n,r.next=i,i.prev=r,t.next=r,r.prev=t,o.next=t,t.prev=o,t}function Nt(n,e,r,t){var i=new st(n,e,r);return t?(i.next=t.next,i.prev=t,t.next.prev=i,t.next=i):(i.prev=i,i.next=i),i}function Be(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function st(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Je.deviation=function(n,e,r,t){var i=e&&e.length,o=i?e[0]*r:n.length,a=Math.abs(at(n,0,o,r));if(i)for(var c=0,s=e.length;c<s;c++){var l=e[c]*r,u=c<s-1?e[c+1]*r:n.length;a-=Math.abs(at(n,l,u,r))}var f=0;for(c=0;c<t.length;c+=3){var m=t[c]*r,d=t[c+1]*r,p=t[c+2]*r;f+=Math.abs((n[m]-n[p])*(n[d+1]-n[m+1])-(n[m]-n[d])*(n[p+1]-n[m+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)};function at(n,e,r,t){for(var i=0,o=e,a=r-t;o<r;o+=t)i+=(n[a]-n[o])*(n[o+1]+n[a+1]),a=o;return i}Je.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},t=0,i=0;i<n.length;i++){for(var o=0;o<n[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(n[i][o][a]);i>0&&(t+=n[i-1].length,r.holes.push(t))}return r};new Ut;new Ut;var At;(n=>{function e(i){let o=i.slice();return o.sort(n.POINT_COMPARATOR),n.makeHullPresorted(o)}n.makeHull=e;function r(i){if(i.length<=1)return i.slice();let o=[];for(let c=0;c<i.length;c++){const s=i[c];for(;o.length>=2;){const l=o[o.length-1],u=o[o.length-2];if((l.x-u.x)*(s.y-u.y)>=(l.y-u.y)*(s.x-u.x))o.pop();else break}o.push(s)}o.pop();let a=[];for(let c=i.length-1;c>=0;c--){const s=i[c];for(;a.length>=2;){const l=a[a.length-1],u=a[a.length-2];if((l.x-u.x)*(s.y-u.y)>=(l.y-u.y)*(s.x-u.x))a.pop();else break}a.push(s)}return a.pop(),o.length==1&&a.length==1&&o[0].x==a[0].x&&o[0].y==a[0].y?o:o.concat(a)}n.makeHullPresorted=r;function t(i,o){return i.x<o.x?-1:i.x>o.x?1:i.y<o.y?-1:i.y>o.y?1:0}n.POINT_COMPARATOR=t})(At||(At={}));function zt(n,e,r){const t=n.slice();return t[21]=e[r],t}function Rt(n,e,r){const t=n.slice();return t[24]=e[r],t}function Vt(n){let e,r;return e=new qe({props:{class:"py-3 px-4 mx-2 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-slate-50 text-gray-800 hover:bg-gray-300 focus:outline-none focus:ring-2 ring-meadow-600 ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",$$slots:{default:[ki]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){q(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,i){K(e,t,i),r=!0},p(t,i){const o={};i&134217728&&(o.$$scope={dirty:i,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function ki(n){let e,r,t;return e=new Pe({props:{id:"flag",size:"1rem",color:"",fill:"0"}}),{c(){q(e.$$.fragment),r=dn(`
				Add waypoint`)},l(i){Y(e.$$.fragment,i),r=mn(i,`
				Add waypoint`)},m(i,o){K(e,i,o),L(i,r,o),t=!0},p:se,i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){P(e.$$.fragment,i),t=!1},d(i){i&&M(r),X(e,i)}}}function jt(n){let e,r,t,i,o,a;function c(l){n[13](l)}let s={};return n[3]!==void 0&&(s.value=n[3]),r=new vr({props:s}),Ne.push(()=>Wt(r,"value",c)),{c(){e=z("div"),q(r.$$.fragment),this.h()},l(l){e=R(l,"DIV",{id:!0,class:!0});var u=H(e);Y(r.$$.fragment,u),u.forEach(M),this.h()},h(){S(e,"id","joystick-container"),S(e,"class","m-4 mb-0 mx-auto"),ie(e,"opacity-50",n[5]!=Te.CONNECTED)},m(l,u){L(l,e,u),K(r,e,null),a=!0},p(l,u){const f={};!t&&u&8&&(t=!0,f.value=l[3],Lt(()=>t=!1)),r.$set(f),(!a||u&32)&&ie(e,"opacity-50",l[5]!=Te.CONNECTED)},i(l){a||(C(r.$$.fragment,l),l&&hn(()=>{a&&(o&&o.end(1),i=pn(e,_t,{duration:100,y:10}),i.start())}),a=!0)},o(l){P(r.$$.fragment,l),i&&i.invalidate(),l&&(o=vn(e,_t,{duration:100,y:10})),a=!1},d(l){l&&M(e),X(r),l&&o&&o.end()}}}function Ft(n){let e,r;return e=new or({props:{thumb:n[24],class:"block size-[25px] cursor-pointer rounded-full border border-border-input bg-white shadow  transition-colors hover:border-dark-40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 active:scale-98 disabled:pointer-events-none disabled:opacity-50 dark:bg-foreground dark:shadow-card"}}),{c(){q(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,i){K(e,t,i),r=!0},p(t,i){const o={};i&524288&&(o.thumb=t[24]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function Bt(n){let e,r;return e=new fr({props:{tick:n[21]}}),{c(){q(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,i){K(e,t,i),r=!0},p(t,i){const o={};i&1048576&&(o.tick=t[21]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){P(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function Ci(n){let e,r,t,i,o,a;r=new $n({props:{class:"absolute h-full bg-foreground"}});let c=He(n[19]),s=[];for(let d=0;d<c.length;d+=1)s[d]=Ft(Rt(n,c,d));const l=d=>P(s[d],1,1,()=>{s[d]=null});let u=He(n[20]),f=[];for(let d=0;d<u.length;d+=1)f[d]=Bt(zt(n,u,d));const m=d=>P(f[d],1,1,()=>{f[d]=null});return{c(){e=z("span"),q(r.$$.fragment),t=$();for(let d=0;d<s.length;d+=1)s[d].c();i=$();for(let d=0;d<f.length;d+=1)f[d].c();o=ue(),this.h()},l(d){e=R(d,"SPAN",{class:!0});var p=H(e);Y(r.$$.fragment,p),p.forEach(M),t=ee(d);for(let h=0;h<s.length;h+=1)s[h].l(d);i=ee(d);for(let h=0;h<f.length;h+=1)f[h].l(d);o=ue(),this.h()},h(){S(e,"class","relative h-2 w-full grow overflow-hidden rounded-full bg-gray-800")},m(d,p){L(d,e,p),K(r,e,null),L(d,t,p);for(let h=0;h<s.length;h+=1)s[h]&&s[h].m(d,p);L(d,i,p);for(let h=0;h<f.length;h+=1)f[h]&&f[h].m(d,p);L(d,o,p),a=!0},p(d,p){if(p&524288){c=He(d[19]);let h;for(h=0;h<c.length;h+=1){const x=Rt(d,c,h);s[h]?(s[h].p(x,p),C(s[h],1)):(s[h]=Ft(x),s[h].c(),C(s[h],1),s[h].m(i.parentNode,i))}for(me(),h=c.length;h<s.length;h+=1)l(h);he()}if(p&1048576){u=He(d[20]);let h;for(h=0;h<u.length;h+=1){const x=zt(d,u,h);f[h]?(f[h].p(x,p),C(f[h],1)):(f[h]=Bt(x),f[h].c(),C(f[h],1),f[h].m(o.parentNode,o))}for(me(),h=u.length;h<f.length;h+=1)m(h);he()}},i(d){if(!a){C(r.$$.fragment,d);for(let p=0;p<c.length;p+=1)C(s[p]);for(let p=0;p<u.length;p+=1)C(f[p]);a=!0}},o(d){P(r.$$.fragment,d),s=s.filter(Boolean);for(let p=0;p<s.length;p+=1)P(s[p]);f=f.filter(Boolean);for(let p=0;p<f.length;p+=1)P(f[p]);a=!1},d(d){d&&(M(e),M(t),M(i),M(o)),X(r),mt(s,d),mt(f,d)}}}function Mi(n){let e,r,t,i,o,a,c;return r=new qe({props:{class:"transition-all pt-3 px-4 inline-flex items-center gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium focus:z-10 border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-slate-200 focus:outline-none focus:bg-slate-300 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800 dark:focus:bg-neutral-800",disabled:n[7]>2,$$slots:{default:[Ei]},$$scope:{ctx:n}}}),r.$on("click",n[9]),i=new qe({props:{class:"pt-3 px-4 inline-flex items-center gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium focus:z-10 border border-gray-200 bg-sky-100 text-sky-600 shadow-sm hover:bg-sky-200 focus:outline-none focus:bg-sky-300 transition-all disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800 dark:focus:bg-neutral-800",disabled:n[7]>1,$$slots:{default:[Ii]},$$scope:{ctx:n}}}),i.$on("click",n[10]),a=new qe({props:{class:"transition-all pt-3 px-4 inline-flex items-center gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium focus:z-10 border border-gray-200 bg-sand-300 text-gray-800 shadow-sm hover:bg-sand-400 focus:outline-none focus:bg-sand-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800 dark:focus:bg-neutral-800",$$slots:{default:[Oi]},$$scope:{ctx:n}}}),a.$on("click",n[11]),{c(){e=z("div"),q(r.$$.fragment),t=$(),q(i.$$.fragment),o=$(),q(a.$$.fragment),this.h()},l(s){e=R(s,"DIV",{class:!0});var l=H(e);Y(r.$$.fragment,l),t=ee(l),Y(i.$$.fragment,l),o=ee(l),Y(a.$$.fragment,l),l.forEach(M),this.h()},h(){S(e,"class","inline-flex rounded-lg shadow-sm m-4")},m(s,l){L(s,e,l),K(r,e,null),A(e,t),K(i,e,null),A(e,o),K(a,e,null),c=!0},p(s,l){const u={};l&128&&(u.disabled=s[7]>2),l&134217792&&(u.$$scope={dirty:l,ctx:s}),r.$set(u);const f={};l&128&&(f.disabled=s[7]>1),l&134217792&&(f.$$scope={dirty:l,ctx:s}),i.$set(f);const m={};l&134217792&&(m.$$scope={dirty:l,ctx:s}),a.$set(m)},i(s){c||(C(r.$$.fragment,s),C(i.$$.fragment,s),C(a.$$.fragment,s),c=!0)},o(s){P(r.$$.fragment,s),P(i.$$.fragment,s),P(a.$$.fragment,s),c=!1},d(s){s&&M(e),X(r),X(i),X(a)}}}function Pi(n){let e,r,t,i,o,a="Out of Service",c;return t=new Pe({props:{id:"do_not_disturb_on",size:"1rem",color:""}}),{c(){e=z("div"),r=z("div"),q(t.$$.fragment),i=$(),o=z("p"),o.textContent=a,this.h()},l(s){e=R(s,"DIV",{class:!0});var l=H(e);r=R(l,"DIV",{class:!0});var u=H(r);Y(t.$$.fragment,u),i=ee(u),o=R(u,"P",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-1tigozn"&&(o.textContent=a),u.forEach(M),l.forEach(M),this.h()},h(){S(o,"class",""),S(r,"class","py-3 px-4 flex flex-row opacity-80 pointer-events-none justify-center w-48 gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium border border-gray-200 bg-slate-50 text-gray-800 shadow-sm"),S(e,"class","inline-flex rounded-lg my-4 mx-auto opacity-80")},m(s,l){L(s,e,l),A(e,r),K(t,r,null),A(r,i),A(r,o),c=!0},p:se,i(s){c||(C(t.$$.fragment,s),c=!0)},o(s){P(t.$$.fragment,s),c=!1},d(s){s&&M(e),X(t)}}}function wi(n){let e,r,t,i,o,a="Disconnected <br/>from Steward",c;return t=new Pe({props:{id:"link_off",size:"1.5rem",color:""}}),{c(){e=z("div"),r=z("div"),q(t.$$.fragment),i=$(),o=z("p"),o.innerHTML=a,this.h()},l(s){e=R(s,"DIV",{class:!0});var l=H(e);r=R(l,"DIV",{class:!0});var u=H(r);Y(t.$$.fragment,u),i=ee(u),o=R(u,"P",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-1s8zlll"&&(o.innerHTML=a),u.forEach(M),l.forEach(M),this.h()},h(){S(o,"class",""),S(r,"class","py-3 px-4 flex flex-row pointer-events-none justify-center w-48 gap-x-2 -ms-px first:rounded-s-lg first:ms-0 last:rounded-e-lg text-sm font-medium border border-gray-200 bg-slate-50 text-gray-800 shadow-sm"),S(e,"class","inline-flex rounded-lg my-4 mx-auto")},m(s,l){L(s,e,l),A(e,r),K(t,r,null),A(r,i),A(r,o),c=!0},p:se,i(s){c||(C(t.$$.fragment,s),c=!0)},o(s){P(t.$$.fragment,s),c=!1},d(s){s&&M(e),X(t)}}}function Ei(n){let e,r,t,i,o,a="Manual",c,s,l,u;return t=new Pe({props:{id:"search_hands_free",size:"1.5rem",color:"",fill:"0"}}),l=new Pe({props:{id:"circle",color:"#404943",size:"0.5rem"}}),{c(){e=z("div"),r=z("div"),q(t.$$.fragment),i=$(),o=z("p"),o.textContent=a,c=$(),s=z("div"),q(l.$$.fragment),this.h()},l(f){e=R(f,"DIV",{class:!0});var m=H(e);r=R(m,"DIV",{class:!0});var d=H(r);Y(t.$$.fragment,d),i=ee(d),o=R(d,"P",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-f2dr5q"&&(o.textContent=a),d.forEach(M),c=ee(m),s=R(m,"DIV",{class:!0});var p=H(s);Y(l.$$.fragment,p),p.forEach(M),m.forEach(M),this.h()},h(){S(o,"class","text-xs"),S(r,"class","flex flex-col"),ie(r,"animate-pulse",n[6]==re.TELEOP),S(s,"class","pb-1"),ie(s,"opacity-0",n[6]!=re.TELEOP),S(e,"class","flex flex-col")},m(f,m){L(f,e,m),A(e,r),K(t,r,null),A(r,i),A(r,o),A(e,c),A(e,s),K(l,s,null),u=!0},p(f,m){(!u||m&64)&&ie(r,"animate-pulse",f[6]==re.TELEOP),(!u||m&64)&&ie(s,"opacity-0",f[6]!=re.TELEOP)},i(f){u||(C(t.$$.fragment,f),C(l.$$.fragment,f),u=!0)},o(f){P(t.$$.fragment,f),P(l.$$.fragment,f),u=!1},d(f){f&&M(e),X(t),X(l)}}}function Ii(n){let e,r,t,i,o,a="Auto",c,s,l,u;return t=new Pe({props:{id:"smart_toy",size:"1.5rem",color:"",fill:"0"}}),l=new Pe({props:{id:"circle",color:"#404943",size:"0.5rem"}}),{c(){e=z("div"),r=z("div"),q(t.$$.fragment),i=$(),o=z("p"),o.textContent=a,c=$(),s=z("div"),q(l.$$.fragment),this.h()},l(f){e=R(f,"DIV",{class:!0});var m=H(e);r=R(m,"DIV",{class:!0});var d=H(r);Y(t.$$.fragment,d),i=ee(d),o=R(d,"P",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-kz06vp"&&(o.textContent=a),d.forEach(M),c=ee(m),s=R(m,"DIV",{class:!0});var p=H(s);Y(l.$$.fragment,p),p.forEach(M),m.forEach(M),this.h()},h(){S(o,"class","text-xs"),S(r,"class","flex flex-col"),ie(r,"animate-pulse",n[6]==re.AUTO),S(s,"class","pb-1"),ie(s,"opacity-0",n[6]!=re.AUTO),S(e,"class","flex flex-col")},m(f,m){L(f,e,m),A(e,r),K(t,r,null),A(r,i),A(r,o),A(e,c),A(e,s),K(l,s,null),u=!0},p(f,m){(!u||m&64)&&ie(r,"animate-pulse",f[6]==re.AUTO),(!u||m&64)&&ie(s,"opacity-0",f[6]!=re.AUTO)},i(f){u||(C(t.$$.fragment,f),C(l.$$.fragment,f),u=!0)},o(f){P(t.$$.fragment,f),P(l.$$.fragment,f),u=!1},d(f){f&&M(e),X(t),X(l)}}}function Oi(n){let e,r,t,i,o,a="Pause",c,s,l,u;return t=new Pe({props:{id:"pause",size:"1.5rem",color:"",fill:"0"}}),l=new Pe({props:{id:"circle",color:"#404943",size:"0.5rem"}}),{c(){e=z("div"),r=z("div"),q(t.$$.fragment),i=$(),o=z("p"),o.textContent=a,c=$(),s=z("div"),q(l.$$.fragment),this.h()},l(f){e=R(f,"DIV",{class:!0});var m=H(e);r=R(m,"DIV",{class:!0});var d=H(r);Y(t.$$.fragment,d),i=ee(d),o=R(d,"P",{class:!0,"data-svelte-h":!0}),Ie(o)!=="svelte-1n6fk0q"&&(o.textContent=a),d.forEach(M),c=ee(m),s=R(m,"DIV",{class:!0});var p=H(s);Y(l.$$.fragment,p),p.forEach(M),m.forEach(M),this.h()},h(){S(o,"class","text-xs"),S(r,"class","flex flex-col"),ie(r,"animate-pulse",n[6]==re.STOPPED),S(s,"class","pb-1"),ie(s,"opacity-0",n[6]!=re.STOPPED),S(e,"class","flex flex-col")},m(f,m){L(f,e,m),A(e,r),K(t,r,null),A(r,i),A(r,o),A(e,c),A(e,s),K(l,s,null),u=!0},p(f,m){(!u||m&64)&&ie(r,"animate-pulse",f[6]==re.STOPPED),(!u||m&64)&&ie(s,"opacity-0",f[6]!=re.STOPPED)},i(f){u||(C(t.$$.fragment,f),C(l.$$.fragment,f),u=!0)},o(f){P(t.$$.fragment,f),P(l.$$.fragment,f),u=!1},d(f){f&&M(e),X(t),X(l)}}}function Ti(n){let e,r;return{c(){e=z("img"),this.h()},l(t){e=R(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){ht(e.src,r=n[4])||S(e,"src",r),S(e,"alt","Camera stream"),S(e,"class","w-[24rem] h-[16rem] absolute bottom-0 m-4 rounded-lg")},m(t,i){L(t,e,i)},p(t,i){i&16&&!ht(e.src,r=t[4])&&S(e,"src",r)},d(t){t&&M(e)}}}function Si(n){let e,r='<span class="material-symbols-outlined text-4xl">videocam_off</span>';return{c(){e=z("div"),e.innerHTML=r,this.h()},l(t){e=R(t,"DIV",{class:!0,"data-svelte-h":!0}),Ie(e)!=="svelte-zpv1b1"&&(e.innerHTML=r),this.h()},h(){S(e,"class","w-[18rem] h-[12rem] absolute bottom-0 m-4 rounded-lg flex items-center justify-center border-2")},m(t,i){L(t,e,i)},p:se,d(t){t&&M(e)}}}function Ni(n){let e,r,t,i,o,a,c,s,l,u,f,m,d,p,h,x,O="Assistance Level",F,D,v,B,Q,k,E,I,N={};o=new Vn({props:N}),n[12](o),s=new Rn({});let g=n[0]&&Vt(n),b=n[6]==re.TELEOP&&Te.CONNECTED&&n[7]<3&&jt(n);function y(_){n[14](_)}let j={min:0,max:3,step:1,class:"relative flex w-full touch-none select-none items-center",$$slots:{default:[Ci,({thumbs:_,ticks:T})=>({19:_,20:T}),({thumbs:_,ticks:T})=>(_?524288:0)|(T?1048576:0)]},$$scope:{ctx:n}};n[2]!==void 0&&(j.teleop_assistance_level=n[2]),D=new qn({props:j}),Ne.push(()=>Wt(D,"teleop_assistance_level",y));const J=[wi,Pi,Mi],W=[];function pe(_,T){return _[5]!=Te.CONNECTED?0:_[7]==3?1:2}Q=pe(n),k=W[Q]=J[Q](n);function G(_,T){return _[4]==""?Si:Ti}let V=G(n),w=V(n);return{c(){e=z("meta"),r=$(),t=z("div"),i=z("div"),q(o.$$.fragment),a=$(),c=z("div"),q(s.$$.fragment),l=$(),u=z("div"),g&&g.c(),f=$(),m=z("div"),d=z("div"),b&&b.c(),p=$(),h=z("div"),x=z("p"),x.textContent=O,F=$(),q(D.$$.fragment),B=$(),k.c(),E=$(),w.c(),this.h()},l(_){const T=fn("svelte-1fo5sqm",document.head);e=R(T,"META",{name:!0,content:!0}),T.forEach(M),r=ee(_),t=R(_,"DIV",{class:!0});var Z=H(t);i=R(Z,"DIV",{class:!0});var ae=H(i);Y(o.$$.fragment,ae),ae.forEach(M),a=ee(Z),c=R(Z,"DIV",{class:!0});var te=H(c);Y(s.$$.fragment,te),te.forEach(M),l=ee(Z),u=R(Z,"DIV",{id:!0,class:!0});var ne=H(u);g&&g.l(ne),ne.forEach(M),f=ee(Z),m=R(Z,"DIV",{class:!0});var le=H(m);d=R(le,"DIV",{id:!0,class:!0});var fe=H(d);b&&b.l(fe),p=ee(fe),h=R(fe,"DIV",{class:!0});var Ae=H(h);x=R(Ae,"P",{class:!0,"data-svelte-h":!0}),Ie(x)!=="svelte-1u4s902"&&(x.textContent=O),F=ee(Ae),Y(D.$$.fragment,Ae),Ae.forEach(M),B=ee(fe),k.l(fe),fe.forEach(M),le.forEach(M),E=ee(Z),w.l(Z),Z.forEach(M),this.h()},h(){document.title="Steward | Canopy",S(e,"name","description"),S(e,"content","Control and observe the robot"),S(i,"class","w-[50%] bg-blue-300"),S(c,"class","w-[50%]"),S(u,"id","topright"),S(u,"class","absolute top-0 right-0 p-4 flex flex-row"),S(x,"class","text-sm pb-"),S(h,"class","w-48 h-8 px-4 overflow-hidden flex flex-col justify-center"),S(d,"id","joystick-div"),S(d,"class","absolute bottom-0 right-0 flex flex-col mx-3"),ie(d,"pointer-events-none",n[5]!=Te.CONNECTED),S(m,"class","grow overflow-hidden"),S(t,"class","flex flex-row h-full w-full")},m(_,T){A(document.head,e),L(_,r,T),L(_,t,T),A(t,i),K(o,i,null),A(t,a),A(t,c),K(s,c,null),A(t,l),A(t,u),g&&g.m(u,null),A(t,f),A(t,m),A(m,d),b&&b.m(d,null),A(d,p),A(d,h),A(h,x),A(h,F),K(D,h,null),A(d,B),W[Q].m(d,null),A(t,E),w.m(t,null),I=!0},p(_,[T]){const Z={};o.$set(Z),_[0]?g?(g.p(_,T),T&1&&C(g,1)):(g=Vt(_),g.c(),C(g,1),g.m(u,null)):g&&(me(),P(g,1,1,()=>{g=null}),he()),_[6]==re.TELEOP&&Te.CONNECTED&&_[7]<3?b?(b.p(_,T),T&192&&C(b,1)):(b=jt(_),b.c(),C(b,1),b.m(d,p)):b&&(me(),P(b,1,1,()=>{b=null}),he());const ae={};T&135790592&&(ae.$$scope={dirty:T,ctx:_}),!v&&T&4&&(v=!0,ae.teleop_assistance_level=_[2],Lt(()=>v=!1)),D.$set(ae);let te=Q;Q=pe(_),Q===te?W[Q].p(_,T):(me(),P(W[te],1,1,()=>{W[te]=null}),he(),k=W[Q],k?k.p(_,T):(k=W[Q]=J[Q](_),k.c()),C(k,1),k.m(d,null)),(!I||T&32)&&ie(d,"pointer-events-none",_[5]!=Te.CONNECTED),V===(V=G(_))&&w?w.p(_,T):(w.d(1),w=V(_),w&&(w.c(),w.m(t,null)))},i(_){I||(C(o.$$.fragment,_),C(s.$$.fragment,_),C(g),C(b),C(D.$$.fragment,_),C(k),I=!0)},o(_){P(o.$$.fragment,_),P(s.$$.fragment,_),P(g),P(b),P(D.$$.fragment,_),P(k),I=!1},d(_){_&&(M(r),M(t)),M(e),n[12](null),X(o),X(s),g&&g.d(),b&&b.d(),X(D),W[Q].d(),w.d()}}}function Ai(n,e,r){let t,i,o;de(n,bn,v=>r(5,t=v)),de(n,_n,v=>r(6,i=v)),de(n,xn,v=>r(7,o=v));let a=!0,c,s=2,l=ve(),u,f=!0;l.subscribe(v=>{if(!v)return;if(Math.abs(v.x)<.01&&Math.abs(v.y)<.01){if(f)return;f=!0}else f=!1;let B=v;B.x*=-2,B.y*=.8,pt.set(B),u=v}),setInterval(()=>{u!=null&&!f&&pt.set(u)},.1);let m="";gn.subscribe(v=>{v&&r(4,m=`data:image/jpg;base64,${v}`)});function d(){c.listenForWaypoint()}function p(){window.onRequestMode(re.TELEOP)}function h(){window.onRequestMode(re.AUTO)}function x(){window.onRequestMode(re.STOPPED)}function O(v){Ne[v?"unshift":"push"](()=>{c=v,r(1,c)})}function F(v){l=v,r(3,l)}function D(v){s=v,r(2,s)}return[a,c,s,l,m,t,i,o,d,p,h,x,O,F,D]}class eo extends Ce{constructor(e){super(),Me(this,e,Ai,Ni,_e,{})}}export{eo as component,$i as universal};
